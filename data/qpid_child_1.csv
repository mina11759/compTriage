Issue Type,Issue key,Issue id,title,Assignee,Reporter,Status,Resolution,Updated,component_1,component_2,component_3,description
Bug,QPID-1835,12424419,C++ qpidbroker.vcproj missing from RC1 kit,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Build,NONE,The cpp/src/qpidbroker.vcproj file is missing from the RC1 kit. This is required to build the C++ broker.
Bug,QPID-7893,13096466,compilation failure on Fedora 26,jross,robbie,Resolved,Fixed,2021-02-01 11:54,Broker,Build,Client,"When trying to compile qpid-cpp master (commit 55d4171a8155d9f6a07a48507e33d43b8cb6d904) on Fedora 26, I get some 'maybe-uninitialized' related complication failures (see attachment). 

Adding ""-DCMAKE_CXX_FLAGS=-Wno-error=maybe-uninitialized"" to the initial cmake run seemed to get things going though obviously might not be correct.
"
Bug,QPID-1835,12424419,C++ qpidbroker.vcproj missing from RC1 kit,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Build,NONE,The cpp/src/qpidbroker.vcproj file is missing from the RC1 kit. This is required to build the C++ broker.
Bug,QPID-7893,13096466,compilation failure on Fedora 26,jross,robbie,Resolved,Fixed,2021-02-01 11:54,Broker,Build,Client,"When trying to compile qpid-cpp master (commit 55d4171a8155d9f6a07a48507e33d43b8cb6d904) on Fedora 26, I get some 'maybe-uninitialized' related complication failures (see attachment). 

Adding ""-DCMAKE_CXX_FLAGS=-Wno-error=maybe-uninitialized"" to the initial cmake run seemed to get things going though obviously might not be correct.
"
Bug,QPID-5646,12703761,Can't build against any released version of proton,astitcher,gsim,Closed,Fixed,2014-06-03 15:34,Broker,Client,NONE,"as a result of changes for QPID-5631.

Both trunk and beta need to be able to build against a released version of proton."
Bug,QPID-5488,12689352,Apparent corruption of SSL connection,astitcher,jross,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,ssl_test fails.  See attached output for details.
Bug,QPID-5445,12686235,Make install writes to OS-reserved location despite setting prefix,mcpierce,jross,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"The qmfgen install ignores the install prefix.  An unprivileged install will fail:

http://people.apache.org/~jross/qpid-cpp-0.26-rc2-make-install-to-prefix.txt

Worse, a privileged install can overwrite system-installed code."
Bug,QPID-2674,12467117,heartbeats can cause seg faults under tcp on linux,astitcher,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"If there is a queued callback that is processed during a writeable
event (or read-writeable) the writeable callback, i.e. AsynchIO::writeable(), takes the path through
line 536 of AsyncIO.cpp, then AsynchIOHandler::closedSocket() is called
which deletes the AsynchIOHandler instance, the thread then goes on to process the callbacks in DipatchHandle, which invoke on the now deleted AsynchIOHandler.

Results in cores like:

Core was generated by `/home/gordon/qpid/cpp/build/src/.libs/lt-qpidd
--load-module /home/gordon/qpid/'.
Program terminated with signal 11, Segmentation fault.
[New process 9483]
[New process 9516]
[New process 9490]
[New process 9489]
[New process 9488]
[New process 9487]
[New process 9486]
[New process 9484]
#0  0x00002aaefd5e999d in qpid::sys::AsynchIOHandler::disconnect
(this=0x1a4f0880) at ../../src/qpid/sys/AsynchIOHandler.cpp:194
194     if (codec) codec->closed();
(gdb) bt
#0  0x00002aaefd5e999d in qpid::sys::AsynchIOHandler::disconnect
(this=0x1a4f0880) at ../../src/qpid/sys/AsynchIOHandler.cpp:194
#1  0x00002aaefd5e9c29 in qpid::sys::AsynchIOHandler::eof (this=0x2aaab1b330c0,
a=@0x1a8778a0) at ../../src/qpid/sys/AsynchIOHandler.cpp:177
#2  0x00002aaefd51ccbf in boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#3  0x00002aaefd51c873 in
boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void,
boost::_mfi::mf1<void, qpid::sys::posix::AsynchIO, boost::function1<void,
qpid::sys::AsynchIO&, std::allocator<boost::function_base> > >,
boost::_bi::list2<boost::_bi::value<qpid::sys::posix::AsynchIO*>,
boost::_bi::value<boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> > > > >, void,
qpid::sys::DispatchHandle&>::invoke (function_obj_ptr=<value optimized out>,
a0=<value optimized out>) at /usr/include/boost/bind/mem_fn_template.hpp:149
#4  0x00002aaefd5ee49f in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#5  0x00002aaefd5ed2b6 in qpid::sys::DispatchHandle::processEvent
(this=0x1a8778a8, type=qpid::sys::Poller::READ_WRITABLE)
    at ../../src/qpid/sys/DispatchHandle.cpp:309
#6  0x00002aaefd526e98 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/Poller.h:125
#7  0x00002aaefd0844e4 in qpid::broker::Broker::run (this=<value optimized
out>) at ../../src/qpid/broker/Broker.cpp:339
#8  0x0000000000409014 in QpiddDaemon::child (this=0x7fff989850d0) at
../../src/posix/QpiddBroker.cpp:130
#9  0x00002aaefd0a482f in qpid::broker::Daemon::fork (this=0x7fff989850d0) at
../../src/qpid/broker/Daemon.cpp:91
#10 0x0000000000407585 in QpiddBroker::execute (this=<value optimized out>,
options=<value optimized out>) at ../../src/posix/QpiddBroker.cpp:168
#11 0x00000000004057ff in main (argc=12, argv=0x7fff989856b8) at
../../src/qpidd.cpp:80
(gdb) print codec
$1 = (class qpid::sys::ConnectionCodec *) 0x2aaab1b330c0
(gdb) thread apply all bt

Thread 8 (process 9484):
#0  0x00000038f9c92149 in strftime_l () from /lib64/libc.so.6
#1  0x00002aaefd51f111 in qpid::sys::outputFormattedNow (o=@0x413214b0) at
../../src/qpid/sys/posix/Time.cpp:89
#2  0x00002aaefd5da5a1 in qpid::log::Logger::log (this=0x2aaefd895680,
s=@0x2aaefd894d80, msg=@0x41321770) at ../../src/qpid/log/Logger.cpp:77
#3  0x00002aaefd5dfa9c in qpid::log::Statement::log (this=0x2aaefd894d80,
message=@0x41321f90) at ../../src/qpid/log/Statement.cpp:57
#4  0x00002aaefd5f3b4b in qpid::sys::Timer::run (this=0x19b59b40) at
../../src/qpid/sys/Timer.cpp:129
#5  0x00002aaefd51f14a in runRunnable (p=0x413213f0) at
../../src/qpid/sys/posix/Thread.cpp:35
#6  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#7  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 7 (process 9486):
#0  0x00000038fa40ad09 in pthread_cond_wait@@GLIBC_2.3.2 () from
/lib64/libpthread.so.0
#1  0x00002aaefd5f3b73 in qpid::sys::Timer::run (this=0x19b5f490) at
../../include/qpid/sys/posix/Condition.h:63
#2  0x00002aaefd51f14a in runRunnable (p=0x19b5f4c4) at
../../src/qpid/sys/posix/Thread.cpp:35
#3  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#4  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 6 (process 9487):
#0  0x00000038f9cd4018 in epoll_wait () from /lib64/libc.so.6
#1  0x00002aaefd526343 in qpid::sys::Poller::wait (this=0x19b4ee00,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:570
#2  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#3  0x00002aaefd51f14a in runRunnable (p=0x5) at
../../src/qpid/sys/posix/Thread.cpp:35
#4  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#5  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 5 (process 9488):
#0  0x00000038f9cd3f9a in epoll_ctl () from /lib64/libc.so.6
#1  0x00002aaefd525fd7 in qpid::sys::PollerPrivate::resetMode (this=0x19b593a0,
eh=@0x2aaab4090920) at ../../src/qpid/sys/epoll/EpollPoller.cpp:389
#2  0x00002aaefd52624d in qpid::sys::Poller::wait (this=0x19b4ee00,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:558
#3  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#4  0x00002aaefd51f14a in runRunnable (p=0x5) at
../../src/qpid/sys/posix/Thread.cpp:35
#5  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#6  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 4 (process 9489):
#0  0x00000038f9cd447b in accept () from /lib64/libc.so.6
#1  0x00002aaefd511ca4 in qpid::sys::Socket::accept (this=<value optimized
out>) at ../../src/qpid/sys/posix/Socket.cpp:215
#2  0x00002aaefd51a085 in qpid::sys::posix::AsynchAcceptor::readable
(this=0x19b634b0, h=@0x19b634d0) at ../../src/qpid/sys/posix/AsynchIO.cpp:121
#3  0x00002aaefd5ee49f in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() (this=0x157, a0=@0x0)
    at /usr/include/boost/function/function_template.hpp:576
---Type <return> to continue, or q <return> to quit---
#4  0x00002aaefd5ed1f9 in qpid::sys::DispatchHandle::processEvent
(this=0x19b634d0, type=qpid::sys::Poller::READABLE)
    at ../../src/qpid/sys/DispatchHandle.cpp:278
#5  0x00002aaefd526e98 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/Poller.h:125
#6  0x00002aaefd51f14a in runRunnable (p=0x13) at
../../src/qpid/sys/posix/Thread.cpp:35
#7  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#8  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 3 (process 9490):
#0  0x00000038f9cd3f9a in epoll_ctl () from /lib64/libc.so.6
#1  0x00002aaefd525fd7 in qpid::sys::PollerPrivate::resetMode (this=0x19b593a0,
eh=@0x2aaab40dc910) at ../../src/qpid/sys/epoll/EpollPoller.cpp:389
#2  0x00002aaefd52624d in qpid::sys::Poller::wait (this=0x19b4ee00,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:558
#3  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#4  0x00002aaefd51f14a in runRunnable (p=0x5) at
../../src/qpid/sys/posix/Thread.cpp:35
#5  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#6  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 2 (process 9516):
#0  0x00000038f9cd4018 in epoll_wait () from /lib64/libc.so.6
#1  0x00002aaefd526343 in qpid::sys::Poller::wait (this=0x19b65e60,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:570
#2  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b65e60) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#3  0x00002aaefd51f14a in runRunnable (p=0x14) at
../../src/qpid/sys/posix/Thread.cpp:35
#4  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#5  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 1 (process 9483):
#0  0x00002aaefd5e999d in qpid::sys::AsynchIOHandler::disconnect
(this=0x1a4f0880) at ../../src/qpid/sys/AsynchIOHandler.cpp:194
#1  0x00002aaefd5e9c29 in qpid::sys::AsynchIOHandler::eof (this=0x2aaab1b330c0,
a=@0x1a8778a0) at ../../src/qpid/sys/AsynchIOHandler.cpp:177
#2  0x00002aaefd51ccbf in boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#3  0x00002aaefd51c873 in
boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void,
boost::_mfi::mf1<void, qpid::sys::posix::AsynchIO, boost::function1<void,
qpid::sys::AsynchIO&, std::allocator<boost::function_base> > >,
boost::_bi::list2<boost::_bi::value<qpid::sys::posix::AsynchIO*>,
boost::_bi::value<boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> > > > >, void,
qpid::sys::DispatchHandle&>::invoke (function_obj_ptr=<value optimized out>,
a0=<value optimized out>) at /usr/include/boost/bind/mem_fn_template.hpp:149
#4  0x00002aaefd5ee49f in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#5  0x00002aaefd5ed2b6 in qpid::sys::DispatchHandle::processEvent
(this=0x1a8778a8, type=qpid::sys::Poller::READ_WRITABLE)
    at ../../src/qpid/sys/DispatchHandle.cpp:309
#6  0x00002aaefd526e98 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/Poller.h:125
#7  0x00002aaefd0844e4 in qpid::broker::Broker::run (this=<value optimized
out>) at ../../src/qpid/broker/Broker.cpp:339
#8  0x0000000000409014 in QpiddDaemon::child (this=0x7fff989850d0) at
../../src/posix/QpiddBroker.cpp:130
#9  0x00002aaefd0a482f in qpid::broker::Daemon::fork (this=0x7fff989850d0) at
../../src/qpid/broker/Daemon.cpp:91
---Type <return> to continue, or q <return> to quit---
#10 0x0000000000407585 in QpiddBroker::execute (this=<value optimized out>,
options=<value optimized out>) at ../../src/posix/QpiddBroker.cpp:168
#11 0x00000000004057ff in main (argc=12, argv=0x7fff989856b8) at
../../src/qpidd.cpp:80
(gdb)    "
Bug,QPID-2086,12435128,intermittent federated cluster hangs since r810591,aconway,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"On revision 810590 I can run federated_cluster_test_with_node_failure in a loop for over 100 iterations without any hangs.

However on revision 810591 the same loop hangs quite easily (generally within 10 runs or so). "
Bug,QPID-4579,12631962,Fails to build from source with GCC 4.8.0,mcpierce,mcpierce,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"The compiler error seen is:

In file included from ./qpid/framing/FrameHandler.h:23:0,
                 from ./qpid/framing/Proxy.h:22,
                 from qpid/framing/Proxy.cpp:19:
./qpid/framing/Handler.h:52:47: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     template <class F> class Functor : public Handler<T> {
                                               ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^
./qpid/framing/Handler.h:64:30: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     class MemFunRef : public Handler<T> {
                              ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^
cc1plus: all warnings being treated as errors
make[3]: *** [qpid/framing/Proxy.lo] Error 1
In file included from ./qpid/framing/FrameHandler.h:23:0,
                 from ./qpid/framing/InputHandler.h:24,
                 from ./qpid/framing/amqp_framing.h:28,
                 from ./qpid/framing/SendContent.h:22,
                 from qpid/framing/SendContent.cpp:22:
./qpid/framing/Handler.h:52:47: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     template <class F> class Functor : public Handler<T> {
                                               ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^
./qpid/framing/Handler.h:64:30: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     class MemFunRef : public Handler<T> {
                              ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^"
Bug,QPID-3338,12513092,qpidxarm CMake target is missing in 0-12,cliffjansen,cliffjansen,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"cpp/src/CMakeLists.txt was altered for mingw builds in QPID-2905 (r1104662).

The qpidxarm target builds the XA distributed transaction resource manager for use with the Microsoft distributed trasanction coordinator.  It was targeted for Windows builds only, using the CMake variable ""WIN32"".

This variable was changed to ""_MSC_VER"" for QPID-2905, presumably to indicate that the build target should only apply to builds using the Microsoft compiler, and not mingw.  Unfortunately ""_MSC_VER"" is not a recognized CMAKE variable and the qpidxarm target is never generated.

The CMake documentation indicates the the variable ""MSVC"" should be used to indicate The Microsoft compiler compared to mingw.
"
Bug,QPID-3586,12530360,Changes for QPID-3464 break cmake build in tar.gz distribution,astitcher,astitcher,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,The changes to the cmake build system in QPID-3464 added some new cmake build files however they weren't added to the autotools list of files to distribute. As it's autotools that creates the .tar.gz this means that the distribution doesn't have all teh files for the cmake build.
Bug,QPID-1525,12410405,Missing pure virtual method in Windows AsynchIO.cpp,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,svn rev 724233 added a pure virtual method to qpid/sys/AsynchIO.h which was not added to qpid/sys/windows/AsynchIO.cpp. This causes the common lib compile to fail. Must be fixed for M4.
Bug,QPID-4345,12609110,Windows memory leak,cliffjansen,kbonin,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,In our large system performance test environments we see Broker memory growth until the process crashes.  This appears to be reproducible simply by opening and closing connections as fast as possible.  Marked as 'Blocker' as it was blocking shipment of our Windows based product - the Broker would exhaust memory and crash itself every few days of operation.
Bug,QPID-1546,12411098,M4 RC5 Windows Visual Studio files munged,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"The Visual Studio project files for the C++ build had some licensing inserted and the line endings changed to Unix. These made them unusable by Visual Studio, so they won't load. I can change the line endings to DOS easily enough, but does the Apache license have to be included in the project files (*.vcproj)? If so, can it go further down the file (right now it's right at the top and Visual Studio screams about it).

I'll fix these things Monday 22-Dec-08 if I can get clarification about the license placement."
Bug,QPID-6470,12787068,FieldValue::getFloatingPointValue() converts endian each time it is called,aconway,pokutnev,Closed,Fixed,2016-09-08 10:26,Broker,Client,Clustering,"When calling getFloatingPointValue multiple times, the octets are endian-converted each time.
Actually we need to make a copy first and then call convertIfRequired()."
Bug,QPID-986,12395058,Need to link libuuid.a to libqpidbroker.so and libqpidclient.so in Qpid/C++,,danushka,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,"When I try to compile a repository working copy of Qpid/C++ I get a build error saying that there are undefined references to ""uuid_generate"" in both libqpidbroker.so and libqpidclient.so. When I was going through the makefile I found that libuuid.a is not linked to these two libs and I could easily get rid of the issue simply by modifying the makefile to link libuuid.a to these two libs."
Bug,QPID-488,12369102,Concurrent access to apr_pools (which are not thread safe),astitcher,gsim,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,The c++ codebase is now set to share an apr pool per process which is a problem as apr_pools are not thread safe.
Bug,QPID-7669,13042093,Unintended UI changes from switch to swigged Python client for management tools,aconway,jross,Resolved,Fixed,2017-11-22 9:54,Broker,Client,NONE,http://qpid.2158936.n2.nabble.com/Qpid-tools-with-python-vs-qpid-cpp-messaging-td7659017.html
Bug,QPID-7494,13017863,Invocation of check_dependencies.py fails on CMake 2.8.11,jross,jross,Resolved,Fixed,2016-11-04 0:07,Broker,Client,NONE,"This annoying issue is discussed here: https://public.kitware.com/Bug/view.php?id=13887 .

It's a bug introduced in cmake 2.8.10 and resolved in 2.8.12.  RHEL 7's cmake version is 2.8.11."
Bug,QPID-6966,12924892,C++ broker and client to support TLS1.1 and TLS1.2 by default,pmoravec,pmoravec,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"Description of problem:
Currently, neither C++ client or broker allows TLS1.1 or TLS1.2 protocol versions. Please enable it, esp. since Java client 6.1 will disable TLS1.0 and use 1.1 and 1.2 only.


Version-Release number of selected component (if applicable):
qpid-cpp-server-0.34-5.el6.x86_64
qpid-cpp-client-0.34-5.el6.x86_64


How reproducible:
100%


Steps to Reproduce:
1. Start qpid broker with SSL configured
2. openssl s_client -tls1_1 -connect localhost:5671
3. openssl s_client -tls1_2 -connect localhost:5671


Actual results:
Both 2 and 3 fails with:

{noformat}
139817551390536:error:1408F10B:SSL routines:SSL3_GET_RECORD:wrong version number:s3_pkt.c:337:
{noformat}


Expected results:
Both should return something like:

{noformat}
CONNECTED(00000003)
depth=0 CN = localhost
verify error:num=18:self signed certificate
verify return:1
depth=0 CN = localhost
verify return:1
140319888385864:error:14094412:SSL routines:SSL3_READ_BYTES:sslv3 alert bad certificate:s3_pkt.c:1256:SSL alert number 42
140319888385864:error:1409E0E5:SSL routines:SSL3_WRITE_BYTES:ssl handshake failure:s3_pkt.c:596:
---
Certificate chain
 0 s:/CN=localhost
   i:/CN=localhost
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIBoDCCAQmgAwIBAgIFAKUDcMswDQYJKoZIhvcNAQEFBQAwFDESMBAGA1UEAxMJ
bG9jYWxob3N0MB4XDTE1MTIzMDExMDYwN1oXDTE2MDMzMDExMDYwN1owFDESMBAG
A1UEAxMJbG9jYWxob3N0MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCgCq6w
o6FW7gIpAQu8y74wuREH6aGo6hc6YVfATz503o7dxqmUUKs6+DkqbEiDu43r51QL
Sb7oduLMmrvC5TfhWEZGe3PYPOuCBbpqDxXs5kKlqSCuIbvDv1ua1WXdqb27/jGr
d6Lf+DsnU+GXrGwLY1W1zchagmFU1P2dLh8JhQIDAQABMA0GCSqGSIb3DQEBBQUA
A4GBACUauXrJB/P0za8mPj5As4uQ3kr7CHIAtFBEAd3MvVmf9RHniMU/resXeE1B
CBOZ4kXmTvVQ+/kDxYTXO/pLq0wh4HHuZC4LrmlIHG2WagEskVnYgqJiHUchKi+8
URu/CX4rW6/EdcAHhPsKX6nlHFFKYg5u9b9ZtQHYMrfryStZ
-----END CERTIFICATE-----
subject=/CN=localhost
issuer=/CN=localhost
---
Acceptable client certificate CA names
/CN=dummy
---
SSL handshake has read 565 bytes and written 202 bytes
---
New, TLSv1/SSLv3, Cipher is AES128-GCM-SHA256
Server public key is 1024 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : AES128-GCM-SHA256
    Session-ID: 7D6C1CB53B37700F2BF007D0D079AB72F26A9D289BCA8D98B5B3F1E283311991
    Session-ID-ctx: 
    Master-Key: 448215BEAADBFF90B82B421D182F8AD7174426D9292835775C405A7C3AEC2763E5F2A1127E5AE210ADC6B7335EE1F6FA
    Key-Arg   : None
    Krb5 Principal: None
    PSK identity: None
    PSK identity hint: None
    Start Time: 1451483784
    Timeout   : 7200 (sec)
    Verify return code: 18 (self signed certificate)
---
{noformat}

Additional info:"
Bug,QPID-7393,12996942,Unavailable buffers in Windows SSL,cliffjansen,cliffjansen,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"From the user list (acartcat Cartwright_Andrew@cat.com):

> I get the following error in the broker, looks like the same error as
> QPID-5033.
[...]
> 2016-05-26 05:22:23 [System] error No IO buffers available: getQueuedBuffer
> with empty queue. Debug data: 0 1 0 3 0 0 1
[...]
> This can be triggered on demand using:
> qpid-send -b ssl:XXXXXXXX.com:5671 --connection-options {protocol:amqp1.0}
> -a testerq --content-string=hello --messages 200

In my testing, qpid-send must also be Windows based.  I do not see the error
if it is sent from a client running on Linux.

This error is caused by the SChannel driver generating (valid but
useless) empty SSL packets when a zero length write is requested from
the codec on the client side.  On the server side, these are
processed and empty read callbacks are generated, even after close.

The WSAENOBUFS happens as a side effect of recursive calls to
sslDataIn while processing adjacent empty packets.

"
Bug,QPID-7145,12950854,auto_ptr is deprecated from C++11 and onwards and its use causes a warning with GCC 6,astitcher,astitcher,Closed,Fixed,2016-09-06 21:32,Broker,Client,Clustering,"As we compile qpid with warnings turned to errors this causes the build to fail by default when compiling with GCC6.

The simplest ""fix"" is just to turn of deprecation warnings.

A better fix would be to stop using auto_ptr. An good alternative in the context of qpid would be boost::scoped_ptr.

If we change the base C++ version for qpid we could use std::unique_ptr instead."
Bug,QPID-7302,12979297,race between auto-delete and re-declare/consume ,gsim,gsim,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"In AMQP 0-10, declare and consume are two distinct operations. When creating a receiver through qpid::messaging, we first declare then consume from the queue.

For a timed auto-delete queue, the delayed auto-delete can tae place between the declare and the consume, resulting in a session error. It would be nice to avoid this. The workaround of course is to set the delay for auto-delete to be sufficiently large that the client will either have reconnected or is likely not reconnecting.

However a simple solution would be to reset the timer on the declare, allowing time for the consume.

This does not prevent the race between a non-timed auto-delete triggered by one session and declare/consume from a different client connection."
Bug,QPID-6409,12776994,Taking address of a 0-length vector throws exception,shuston,shuston,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"In Debug-mode builds, std::vector in VS2013 will throw an exception if trying to do:  &argv[0]  if argv has 0 length. This construct happens in cpp/src/tests/BrokerFixture.h, so happens in many of the unit tests."
Bug,QPID-6511,12823911,"[C++ Broker, clients] AMQP 0-10 windows clients can not connect to --no-auth broker",chug,chug,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"Broker
{noformat}
./qpidd --auth no
{noformat}
Windows client
{noformat}
spout -b my-broker:5672 amq.topic
{noformat}
Fails with ""Not authenticated!""

The behavior change was in the broker as part of QPID-6325. Arguably the change is a good thing as it prevents clients connecting to the broker with no name. However, it makes for a poor out-of-the-box experience with a no-auth broker rejecting connections with an auth error. 

Clients can make a connection by adding:
{noformat}
--connection-options ""{username:dummy}""
or
--connection-options ""{sasl-mechanisms:ANONYMOUS}""
{noformat}
But the change breaks years of accumulated self tests that work just fine against older versions of qpidd.

The proposal to fix this is to make the Windows client provide the same connection defaults as linux cyrus sasl. "
Bug,QPID-6529,12827038,[C++ Client] Fails to compile with Proton 0.10,chug,chug,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"Proton version detection logic
{noformat}
if (Proton_VERSION GREATER 0.8)
{noformat}
gets it wrong when Proton is 0.10.
"
Bug,QPID-6399,12776036,Windows run_test.ps1 script needs revamp to match run_test,shuston,shuston,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"Some time back the run_test script was expanded to offer new capabilities and the cmake testing invocation changed to match. The run_test.ps1 script is still expecting ""old"" invocation and needs a makeover."
Bug,QPID-3540,12526463,"Typecasting and alignment requirements for various platforms - ""increases required alignment of target type""",,chug,Closed,Fixed,2015-06-16 8:35,Broker,Client,NONE,"On sparc/solaris (and others) the following code generates an error:

  qpid/cpp/src/qpid/RefCountedBuffer.cpp line 37
    boost::intrusive_ptr<RefCounted>(reinterpret_cast<RefCountedBuffer*>(store)),

A workaround is the '(void *)' hack that quiets the compiler but leaves the
code exposed to a run time fault if the store object is not properly aligned:

    boost::intrusive_ptr<RefCounted>(reinterpret_cast<RefCountedBuffer*>((void*)store)),

Another error shows up in
  
  qpid/cpp/src/tests/qpid-perftest.cpp line 647
    size_t n = *reinterpret_cast<const size_t*>(msg.getData().data() + offset);

The (void *) hack silences the error here, too, but the run time code is exposed to
a data alignment fault.

I propose that these two pieces of code need work to guarantee the alignment
or to work around any memory reference fault.

1. In the store case, new() probably returns an address that meets the alignment
requirement. An assert would help diagnose when this assumption fails.

2. In the qpid-perftest case the size_t could be extracted from the raw buffer
with a memcpy and that would be safe to do in all architectures.

2A. A separate issue is the fact that size_t changes between 32-bit and 64-bit
platforms, and that the size_t does not appear to be byte swapped for interop
between big and little endian systems. If these messages are consumed only
by the sender then no problem.


"
Bug,QPID-6021,12735090,[AMQP 1.0] Improve performance,gsim,gsim,Closed,Fixed,2015-03-19 12:23,Broker,Client,NONE,Performance is poorer when using AMQP 1.0  (as compared to using AMQP 0-10). This is a JIRA to highlight a few changes to improve things in the next release cycle.
Bug,QPID-6160,12748712,CLONE - [CPP Broker] [CPP Client] Disable SSLv3 support,kgiusti,kgiusti,Closed,Fixed,2015-03-19 12:23,Broker,Client,NONE,"SSLv3 is vulnerable to CVE-2014-3566, and will not fixed. 

Wherever a seure connection is established we should ensure that SSLv3 is not in the supported protocols."
Bug,QPID-6321,12768157,Can't build against latest 0.9,gsim,gsim,Closed,Fixed,2015-03-19 12:22,Broker,Client,NONE,Change to pn_delivery_tag_t breaks build.
Bug,QPID-6444,12781190,Build fails due to unused function warning,astitcher,astitcher,Closed,Fixed,2015-03-19 12:22,Broker,Client,NONE,"[0.32 RC fails to build with default instructions]

[59/254] Building CXX object src/CMake....dir/qpid/broker/amqp/Connection.cpp.o
FAILED: /usr/lib64/ccache/c++   -DXQ_EFFECTIVE_BOOLEAN_VALUE_HPP -D_IN_QPID_BROKER -Damqp_EXPORTS -fvisibility-inlines-hidden -Werror -pedantic -Wall -Wextra -Wno-shadow -Wpointer-arith -Wcast-qual -Wcast-align -Wno-long-long -Wvolatile-register-var -Winvalid-pch -Wno-system-headers -Woverloaded-virtual -O2 -g -DNDEBUG -fPIC -I/home/andrew/Work/qpid/src-released/qpid/cpp/src -I/home/andrew/Work/qpid/src-released/qpid/cpp/src/../include -Isrc -Isrc/../include -I/usr/include/nss3 -I/usr/include/nspr4    -pthread -MMD -MT src/CMakeFiles/amqp.dir/qpid/broker/amqp/Connection.cpp.o -MF src/CMakeFiles/amqp.dir/qpid/broker/amqp/Connection.cpp.o.d -o src/CMakeFiles/amqp.dir/qpid/broker/amqp/Connection.cpp.o -c /home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/broker/amqp/Connection.cpp
/home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/broker/amqp/Connection.cpp:457:13: error: ?˜std::string qpid::broker::amqp::{anonymous}::convert(pn_delivery_tag_t)??defined but not used [-Werror=unused-function]
 std::string convert(pn_delivery_tag_t in)
             ^
cc1plus: all warnings being treated as errors
[107/254] Building CXX object src/CMak...pid/messaging/amqp/AddressHelper.cpp.o
FAILED: /usr/lib64/ccache/c++   -DXQ_EFFECTIVE_BOOLEAN_VALUE_HPP -Dqpidmessaging_EXPORTS -fvisibility-inlines-hidden -Werror -pedantic -Wall -Wextra -Wno-shadow -Wpointer-arith -Wcast-qual -Wcast-align -Wno-long-long -Wvolatile-register-var -Winvalid-pch -Wno-system-headers -Woverloaded-virtual -O2 -g -DNDEBUG -fPIC -I/home/andrew/Work/qpid/src-released/qpid/cpp/src -I/home/andrew/Work/qpid/src-released/qpid/cpp/src/../include -Isrc -Isrc/../include -I/usr/include/nss3 -I/usr/include/nspr4    -pthread -fno-visibility-inlines-hidden -fvisibility=hidden -MMD -MT src/CMakeFiles/qpidmessaging.dir/qpid/messaging/amqp/AddressHelper.cpp.o -MF src/CMakeFiles/qpidmessaging.dir/qpid/messaging/amqp/AddressHelper.cpp.o.d -o src/CMakeFiles/qpidmessaging.dir/qpid/messaging/amqp/AddressHelper.cpp.o -c /home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/messaging/amqp/AddressHelper.cpp
/home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/messaging/amqp/AddressHelper.cpp:141:6: error: ?˜bool qpid::messaging::amqp::{anonymous}::contains(const List&, const string&)??defined but not used [-Werror=unused-function]
 bool contains(const Variant::List& list, const std::string& item)
      ^
cc1plus: all warnings being treated as errors
"
Bug,QPID-6069,12738917,Does not compile under C++11 on FreeBSD,astitcher,astitcher,Closed,Fixed,2014-09-26 21:40,Broker,Client,NONE,There are some small compile problems that have crept in over the 0.30 release cycle that prevent qpid from compiling with clang++ and libc++ under FreeBsd 10.
Bug,QPID-5886,12726451,C++  Broker OutgoingMessage change exposes Completion handle export issue on Windows,chug,chug,Closed,Fixed,2014-09-26 15:43,Broker,Client,NONE,"Windows builds have been failing mysteriously for me for a few weeks[1]. I found the issues/ QPID-5828 r1604952 changed OutgoingMessage such that the Completion object now needs to access Handle<CompletionImpl>::isValid().

Simply instantiating the Handle superclass (r1525706 for example) didn't work. On windows the classes won't export from a .h file but need to come from .cpp files. Review is coming up shortly.

[1] Why some builds work and some don't is unsolved."
Bug,QPID-5865,12724737,The client and broker heartbeat code can get confused when the system time changes,astitcher,astitcher,Closed,Fixed,2014-09-26 15:42,Broker,Client,NONE,"The underlying timekeeping code in C++ qpid currently uses CLOCK_REALTIME which is related to wallclock time and can go backwards and skip time forwards (either due to NTP or administrator action).

This is not ideal because it can cause false timeouts to occur based on the system time rather than elapsed time.

It would be better for most timing to be based on CLOCK_MONOTONIC which is steadily increasing time based on the system uptime. That will avoid problems due to the system time changing."
Bug,QPID-5395,12682891,[AMQP 1.0] direct proton tracing into qpids own logging,gsim,gsim,Closed,Fixed,2014-06-03 15:35,Broker,Client,NONE,At present protons tracing is entirely distinct from qpidcpp's logging (whether qpidd or qpid:messaging). This means you can't direct the tracing to a file or to syslog. Traces from concurrent connections often get interleaved making them very hard to read.
Bug,QPID-5384,12682381,[AMQP 1.0] can't assert on autodelete property,gsim,gsim,Closed,Fixed,2014-06-03 15:35,Broker,Client,NONE,this is a result of it actually being communicated as a lifetime-policy (at least in the case of queues)
Bug,QPID-5427,12685124,It is possible to mask critical logging messages,astitcher,astitcher,Closed,Fixed,2014-06-03 15:35,Broker,Client,NONE,"As far as I understand it the entire point of log messages at the ""critical"" level is that they cannot be turned off at all. That is what critical means - the user *must* be informed of the confition being logged.

Unfortunately for a little while now it has been possible to turn all log levels off by specifying ""--log-disable trace+"" or using ""--log-enable !trace+"".
"
Bug,QPID-5658,12706289,C++ code not compiling with libc++,astitcher,astitcher,Closed,Fixed,2014-06-03 15:34,Broker,Client,NONE,FreeBSD 10 now uses a new compiler/library chain as default. The new C++ standard library has some small differences than the GNU C++ standard library.
Bug,QPID-5659,12706291,C++ not compiling (correctly) as C++11,astitcher,astitcher,Closed,Fixed,2014-06-03 15:34,Broker,Client,NONE,"In order to avoid a compile bug with libc++ and boost you have to compile qpid as C++11 under FreeBSD 10.

The current qpid code needs some small adjustments to compile correctly as C++11"
Bug,QPID-5232,12673855,[AMQP 1.0] receiver links from exchanges should be unreliable by default,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,and also use autodelete queues by default.
Bug,QPID-5146,12669621,[AMQP 1.0] capabilities not handled correctly,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,If there is more than one capability it should be sent as an array of symbols. Need to be able to read capabilities as either an array or a single symbol.
Bug,QPID-4948,12654736,[AMQP 1.0] browsing queues not supported,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,Requires means to set and read the distribution-mode of the receiver link in proton engine.
Bug,QPID-5156,12670147,[AMQP 1.0] assert should check node properties,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"Especially important for dynamic nodes, but would be nice to support existing assert behaviour also. "
Bug,QPID-5341,12679261,Allow use of proton 0.6,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,which is now in rc1 and assuming no significant changes should work fine when released
Bug,QPID-5289,12677384,[AMQP 1.0] error descriptions are not given in exceptions by client,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"E.g. if attempting to transfer to a queue that would exceed max depth, the exception thrown is a connection-exception and simply says 'Connection closed by peer'.

There are two parts to this, one is that this should not be a connection exception but a link exception in 1.0. The second is that the error text sent by the broker should be included in the exception."
Bug,QPID-5110,12666705,[AMQP 1.0] make handling of incorrectly typed properties more robust,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"If a property is sent in the wrong type (e.g. as long instead of ulong), subsequent properties get handled incorrectly. Would be nicer to simply skip (or even by lenient and accept) the incorrect types, but handle all others correctly."
Bug,QPID-5083,12664355,[AMQP 1.0] if sasl implementation is not available client (and interlinking) will fail,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,E.g. if on fedora you build without cyrus-sasl-devel.
Bug,QPID-4792,12645458,Windows UUID processing mingles GUID values,cliffjansen,cliffjansen,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,"RFC 4122 defines a UUID.  A GUID is the same as a UUID in string form, but differs in binary layout.  Microsoft operates with GUIDs but confusingly labels them as UUIDs in their documentation and include files.

i.e. rpcdce.h:  typedef GUID UUID;

The binary form matters since it is used over the wire.  Mapping a GUID to a UUID (or vice versa) without the layout conversion results in structures with mangled RFC version info and different string representations on Windows and non-Windows systems.

Proton currently only calls Microsoft APIs to obtain the string representation of the UUID (which will match the GUID), so it is unaffected.
"
Bug,QPID-4888,12649349,[AMQP 1.0] link naming is not handled correctly,gsim,gsim,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,"The client does not let the name of the link be controlled, but always defaults it to the name of the node (which doesn't meet uniqueness criteria).

The broker uses the link-, source- and target- names as the key to the managment objects and uses the link- and source- name for subscriptions queues when the source refers to an exchange. The link name is only guaranteed to be unique within the scope of a clients container id."
Bug,QPID-4702,12640762,cmake build of ssl support does not work on certain platforms,gsim,gsim,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,This is a result of the order of libraries and object files passed to the linker. The libraries must follow the .o files that require them or they will be ignored (assumed not needed).
Bug,QPID-4976,12656034,[AMQP 1.0] support standard lifetime policies,gsim,gsim,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,"I.e. delete-on-close, delete-on-no-links, delete-on-no-messages and delete-on-no-links-or-messages"
Bug,QPID-3188,12503446,CyrusSasl ctor logic change for callback storage,mgoulish2,mgoulish2,Closed,Fixed,2013-08-20 20:41,Broker,Client,NONE,"The logic that stores callbacks in the CyrusSasl ctor should be changed to make the c++ client behave similarly to other language clients.

If there is no username, then do nothing with either NAME or PASSWD callbacks.
If there is a name but no passwd, then explicitly store an empty PASSWD callback."
Bug,QPID-3620,12531589,time conversions fail on solaris,cliffjansen,cliffjansen,Closed,Fixed,2013-08-20 20:33,Broker,Client,NONE,"Condition::wait(Mutex&, const AbsTime& absoluteTime) fails for far future time during cast/truncation from 64 bit int to posix timespec.tv_sec.  The time is actually in the past and the wait times out instantly."
Bug,QPID-306,12360788,AMQP 0-9 unbind,gsim,aconway,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,Implement new Queue::unbind and Exchange::unbind methods from 0-9.
Bug,QPID-424,12365147,C++: Fix memory leaks,aconway,aconway,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"We need to get to a clean slate on memory leaks, right now valgrind is reporting quite a few.

The current batch of leaks are being suppressed in cpp/test/.vg-supp so that we can make --enable-valgrind the default and catch/fix new leaks quickly going forward. Valgrind errors are equivalent to a test failure, you should not commit with errors.

The supressed leaks also need to be addressed either fix the leak or prove that it's a problem outside qpid's control. 
In the later case the supression description should explain why the leak can safely be ignored."
Bug,QPID-3206,12504157,Variant converts from negative number in string format to unsigned integer without error,gsim,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"E.g. 
  uint16_t i = 0;
  qpid::types::Variant v = ""-5"";
  i = v;

The above results in an exception in older versions of gcc (e.g. 4.1.2) but sets i to 65531 on later versions (e.g. 4.4.4). This is a result of a fix to the gcc std library to be compliant with specification which requires stringstream to accept negative values even for unsigned ints (which is the behaviour of scanf).

See e.g:
http://boost.2283326.n4.nabble.com/conversion-lexical-cast-doesn-t-throw-td2593967.html
http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/97475b21515462c9/ce369a327fa39243#ce369a327fa39243"
Bug,QPID-3030,12497357,C++ buffer encoding allows overflow on write.,kgiusti,kgiusti,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"The framing Buffer::put{Short,Medium,Long}String() or Buffer::putRawData() do not validate the length of the written data, and may allow overflow of the buffer."
Bug,QPID-4452,12617159,issuing and handling of producer credit not implemented,gsim,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,Prevents proper stress testing.
Bug,QPID-1819,12423045,Large messages cause hangs and crashes when using digest-md5 and security layer (ssf 128),gsim,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"crash ends with:

2009-apr-15 17:43:44 trace guest@QPID.6411302a-229c-4eb1-b097-fc8a613a3233: sent cmd 0: content (65495 bytes) cccccccccccccccc...
2009-apr-15 17:43:44 trace SENT [127.0.0.1:56532]: Frame[BEbe; channel=2; {SessionFlushBody: completed=1; }]
2009-apr-15 17:43:44 trace SENT [127.0.0.1:56532]: Frame[Bbe; channel=2; {MessageTransferBody: destination=message_queue; accept-mode=0; acquire-mode=0; }]
2009-apr-15 17:43:44 trace SENT [127.0.0.1:56532]: Frame[be; channel=2; header (47 bytes); properties={{MessageProperties: content-length=65495; }{DeliveryProperties: exchange=amq.direct; routing-key=routing_key; }}]
qpidd: qpid/amqp_0_10/Connection.cpp:93: virtual size_t qpid::amqp_0_10::Connection::encode(const char*, size_t): Assertion `workQueue.empty() || workQueue.front().encodedSize() <= size' failed.


pstack for hung client:

Thread 2 (Thread 0xb7f77b90 (LWP 16187)):
#0  0x0069a416 in __kernel_vsyscall ()
#1  0x00ce1b3b in write () from /lib/libc.so.6
#2  0x0024fd80 in qpid::sys::Socket::write () from /usr/lib/libqpidcommon.so.0
#3  0x00255eb4 in qpid::sys::posix::AsynchIO::writeable ()
#4  0x00259152 in
boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void,
boost::_mfi::mf1<void, qpid::sys::posix::AsynchIO,
qpid::sys::DispatchHandle&>,
boost::_bi::list2<boost::_bi::value<qpid::sys::posix::AsynchIO*>,
boost::arg<1> (*)()> >, void, qpid::sys::DispatchHandle&>::invoke ()
#5  0x002b77d3 in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() () from
/usr/lib/libqpidcommon.so.0
#6  0x002b5b78 in qpid::sys::DispatchHandle::processEvent ()
#7  0x00267ef6 in qpid::sys::Poller::run () from /usr/lib/libqpidcommon.so.0
#8  0x002b53c4 in qpid::sys::Dispatcher::run ()
#9  0x00e8b3d2 in qpid::client::TCPConnector::run ()
#10 0x0025dba1 in ?? () from /usr/lib/libqpidcommon.so.0
#11 0x00dbc51f in start_thread () from /lib/libpthread.so.0
#12 0x00cf204e in clone () from /lib/libc.so.6
Thread 1 (Thread 0xb7f78720 (LWP 16186)):
#0  0x0069a416 in __kernel_vsyscall ()
#1  0x00dc0105 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0
#2  0x00d00e9d in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libc.so.6
#3  0x00e70f4d in qpid::client::Bounds::expand ()
#4  0x00eb4642 in qpid::client::SessionImpl::sendFrame ()
#5  0x00eb479c in qpid::client::SessionImpl::handleOut ()
#6  0x00eb7488 in qpid::client::SessionImpl::sendContent ()
#7  0x00eb7db2 in qpid::client::SessionImpl::sendCommand ()
#8  0x00eb7f07 in qpid::client::SessionImpl::send ()
#9  0x00e68afe in qpid::client::no_keyword::Session_0_10::messageTransfer ()
#10 0x0804cf4f in main ()

"
Bug,QPID-4556,12630133,QueueOptions::setSizePolicy() can cause exception,gsim,brad.hoekstra,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Calling QueueOptions::setSizePolicy() with maxSize > 2GB causes an exception in the C++ broken, which then generates an exception in the C++ client library.

This appears to be because the value is set as an int32 in the FieldTable. The fix appears to be fairly simple:

{noformat} 
Index: 0.20/cpp/src/qpid/client/QueueOptions.cpp
===================================================================
--- 0.20/cpp/src/qpid/client/QueueOptions.cpp	(revision 27169)
+++ 0.20/cpp/src/qpid/client/QueueOptions.cpp	(revision 27170)
@@ -49,8 +49,8 @@
 	
 void QueueOptions::setSizePolicy(QueueSizePolicy sp, uint64_t maxSize, uint32_t maxCount)
 {
-    if (maxCount) setInt(strMaxCountKey, maxCount);
-    if (maxSize) setInt(strMaxSizeKey, maxSize);
+    if (maxCount) setUInt64(strMaxCountKey, maxCount);
+    if (maxSize) setUInt64(strMaxSizeKey, maxSize);
     if (maxSize || maxCount){
         switch (sp)
         {
{noformat} "
Bug,QPID-4257,12605103,"Windows+SSL: Client hang on broker close, broker memory leak",,kbonin,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Windows clients hang when broker dies via SSL connection - fetch never returns even w/ IMMEDIATE timeout.
Windows broker memory grows linearly with SSL connection count, leak per connection, until broker exhausts memory and crashes."
Bug,QPID-243,12359738,Inconsistent use of paths in #includes,astitcher,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"
1. With the new release, I have to specify -I${QPID_REL}/include/qpidc,
-I${QPID_REL/include/qpidc/framing and -I${QPID_REL/include/qpidc/sys when
I build which is really naff.

This is because things like Connector.h do a #include
<framing/InputHandler.h>, but then ""framing/InputHandler.h"" only #include
<AMQFrame.h> and AMQFrame.h is located in the framing sub-directory.

"
Bug,QPID-2407,12456346,C++ SSL session can get bad buffer management,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Thanks to Cliff Jansen for alerting me to this problem.

It's possible for an SSL-negotiated session on Windows to end up with odd errors or an exception. One session I caught in the debugger ended with a ENOBUFS errors on a network receive; the buffer involved ended up having a data-start greater than the length of the buffer, and the calculated receive length for the operation was a negative value.

Can be reproduced using perftest on Windows; I ran against a Linux broker, but similar results can probably happen in either direction depending on the traffic pattern."
Bug,QPID-2728,12468955,Windows icon/version additions broke nightly builds,tross,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Recent additions to include version and icon resources in the Windows builds result in build errors. I don't know why I'm getting different errors on different builds, but here's what I see:

64-bit build:
One of these for each library:
1>.\windows\resources\qpidtypes-resource.rc(20) : fatal error RC1015: cannot open include file 'version-resource.h'.

See: http://www.riverace.com/CDash-1.4.2/viewBuildError.php?buildid=735 for all messages

32-bit build (configure error):
CMake Error in src/CMakeLists.txt:
  Cannot find source file ""qmf-resource.rc"".  Tried extensions .c .C .c++ .cc
  .cpp .cxx .m .M .mm .h .hh .h++ .hm .hpp .hxx .in .txx

"
Bug,QPID-2402,12456036,qpid::messaging.Message::setTTL() unit ambiguity can cause unexpectected behavior,gsim,kbonin,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"qpid::messaging.Message::setTTL( boost::uint64_t ttl ) - does not declare its units.

The currently exposed time types are AbsTime and Duration, which seems to imply they should be used for encapsulating time.

When a Duration object is passed to setTTL, the inline operator int64_t() returns the member variable nanoseconds.

When this value is propagated to the broker, it is interpreted around  /cpp/src/qpid/broker/Message # 353 to be in millisecond units.

I would recommend:
- document Message.setTTL units clearly - pick ms or ns
  - if ms, then overload setTTL to take a Duration object so we can use without error by converting in setTTL
  - if ns, then somewhere downstream (OutgoingMessage#351 ?) the ns needs to get converted to ms

"
Bug,QPID-4095,12596290,Boost 1.50.0 has removed filesystem version 2 from the library,astitcher,davin,Closed,Fixed,2013-07-29 18:53,Broker,Client,Clustering,The build fails when building against boost 1.50.0 because version 0.16 and earlier require boost filesystem version 2 which has been removed from boost version 1.50.0.
Bug,QPID-3457,12520287,qpid::Msg::str() method not exported,aconway,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Trunk r1161742 added a Msg::str() method to cpp/src/qpid/Msg.cpp - this method is not marked with an extern decorator, so it's not visible outside qpidcommon (where Msg.cpp is built) on Windows. This causes build errors on Windows, with unresolved external references to the method."
Bug,QPID-1473,12408786,C++ build process must generate MaxMethodBodySize.h on build platform,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"The release process generates needed C++ code from the various definitions, including MaxMethodBodySize.h, which is very important. However, the MaxMethodBodySize.h generated during release may not be appropriate for all targets. In particular, it is not compatible with what's generated on Windows and results in some static assertion failures that some method bodies are too big. (MAXMETHODBODYSIZE is 148 on Linux, 456 on Windows!)

The fix for this is to have the Windows Visual Studio solution include a project to build the MaxMethodBodySize.h file. I have a project ready and will commit it soon."
Bug,QPID-4011,12556466,TestIsLocalHost unit_test fails with if machine name resolves to loopback address,astitcher,astitcher,Closed,Fixed,2013-07-29 18:53,Broker,Client,Clustering,The new SystemInfo::isLocalHost() code doesn't check correctly for interface addresses that resolve to the loopback address.
Bug,QPID-1458,12408375,C++ common compile error in VC9 Release mode,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"When building C++ common library in Release mode, the following compile errors appear:

1>C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\xutility(419) : error C2664: 'qpid::InlineAllocator<BaseAllocator,Max>::InlineAllocator(const qpid::InlineAllocator<BaseAllocator,Max> &)' : cannot convert parameter 1 from 'qpid::InlineAllocator<BaseAllocator,Max>' to 'const qpid::InlineAllocator<BaseAllocator,Max> &'
1>        with
1>        [
1>            BaseAllocator=std::allocator<std::_Aux_cont>,
1>            Max=3
1>        ]
1>        and
1>        [
1>            BaseAllocator=std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,
1>            Max=3
1>        ]
1>        and
1>        [
1>            BaseAllocator=std::allocator<std::_Aux_cont>,
1>            Max=3
1>        ]
1>        Reason: cannot convert from 'qpid::InlineAllocator<BaseAllocator,Max>' to 'const qpid::InlineAllocator<BaseAllocator,Max>'
1>        with
1>        [
1>            BaseAllocator=std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,
1>            Max=3
1>        ]
1>        and
1>        [
1>            BaseAllocator=std::allocator<std::_Aux_cont>,
1>            Max=3
1>        ]
1>        No user-defined-conversion operator available that can perform this conversion, or the operator cannot be called
1>        C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\xutility(417) : while compiling class template member function 'std::_Container_base_aux_alloc_real<_Alloc>::_Container_base_aux_alloc_real(_Alloc)'
1>        with
1>        [
1>            _Alloc=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\vector(421) : see reference to class template instantiation 'std::_Container_base_aux_alloc_real<_Alloc>' being compiled
1>        with
1>        [
1>            _Alloc=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\vector(439) : see reference to class template instantiation 'std::_Vector_val<_Ty,_Alloc>' being compiled
1>        with
1>        [
1>            _Ty=qpid::Range<qpid::framing::SequenceNumber>,
1>            _Alloc=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        .\qpid/InlineVector.h(42) : see reference to class template instantiation 'std::vector<_Ty,_Ax>' being compiled
1>        with
1>        [
1>            _Ty=qpid::Range<qpid::framing::SequenceNumber>,
1>            _Ax=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        .\qpid/RangeSet.h(168) : see reference to class template instantiation 'qpid::InlineVector<T,Max>' being compiled
1>        with
1>        [
1>            T=qpid::Range<qpid::framing::SequenceNumber>,
1>            Max=3
1>        ]
1>        c:\ace\exported\qpid\trunk\qpid\cpp\src\qpid\framing\SequenceSet.h(31) : see reference to class template instantiation 'qpid::RangeSet<T>' being compiled
1>        with
1>        [
1>            T=qpid::framing::SequenceNumber
1>        ]

This problem does not occur with VC8, nor with VC9 in Debug mode."
Bug,QPID-3478,12522290,Windows Visual Studio 2010 warning C4251 'needs to have dll interface' qpid::amqp_0_10::MapCodec::contentType,chug,chug,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"File cpp/include/qpid/amqp_0_10/Codecs.h has code to the effect of:

class QPID_COMMON_EXTERN MapCodec
{
  public:
    static const std::string contentType;
  private:
};

VS2010 warns that exporting a std::string from a DLL may have unexpected consequences.

One possible solution is from

http://www.eggheadcafe.com/software/aspnet/30952961/a-solution-to-warning-c4251--class-needs-to-have-dllinterface.aspx

2. You can define a wrapper class that has no inline functions and defines all the potentially compiler-generated functions (default ctor, copy ctor, dtor, and assignment operator) and dllexport that.

Other discussion of this issue:

http://stackoverflow.com/questions/2132747/warning-c4251-when-building-a-dll-that-exports-a-class-containing-an-atlcstring
"
Bug,QPID-1957,12428997,FrameDecoder's append() function accesses out-of-range if appending 0 bytes,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"The append() function in qpid/framing/FrameDecoder.cpp tries to take the address of out-of-range bytes if appending 0 bytes. Although no bytes will actually be written, the [] operator throws an out of range exception in Visual Studio, which is correct since the address of an element that doesn't exist is being requested.

This fixes it:

Index: src/qpid/framing/FrameDecoder.cpp
===================================================================
--- src/qpid/framing/FrameDecoder.cpp   (revision 788779)
+++ src/qpid/framing/FrameDecoder.cpp   (working copy)
@@ -32,7 +32,8 @@
 /** Append up to n bytes from start of buf to end of bytes. */
 void append(std::vector<char>& bytes, Buffer& buffer, size_t n) {
     size_t oldSize = bytes.size();
-    n = std::min(n, size_t(buffer.available()));
+    if ((n = std::min(n, size_t(buffer.available()))) == 0)
+        return;
     bytes.resize(oldSize+n);
     char* p = &bytes[oldSize];
     buffer.getRawData(reinterpret_cast<uint8_t*>(p), n);
"
Bug,QPID-3199,12503979,Severe but difficult to diagnose lock error in qpid::sys::StateMonitor,astitcher,astitcher,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,"The qpid::sys::StateMonitor class has 4 member functions liker this:
  void waitFor(Enum s) { ScopedWait(*this); while (s != state) wait(); }

However the ScopeWait(*this); is in error, because it creates a temporary ScopedWait and then immediately destroys it. Instead of locking this and then unlocking it at the end of the function execution.

What was meant was:
  void waitFor(Enum s) { ScopedWait w(*this); while (s != state) wait(); }

which creates a local variable w which is destroyed at the end of the function execution unlocking this.

It is possible that the compiler/options we use do not actually exhibit this bug. As the correct behaviour may not actually be implemented by all compilers.

If this bug exhibits it might show as StateMonitor::waitFor() never detecting the desired state for instance. It is remarkable that this code has been in the codebase for 3.5 years and we've not noticed any bug caused by it.

This bug was detected by the work on QPID-3004: The clang++ compiler detected that the value being returned by the constructor was not being used at all."
Bug,QPID-2392,12455496,Powershell scripts not included in release source kits,shuston,shuston,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,The release process for 0.6 didn't contain the Powershell scripts for the C++ broker/client test suite on Windows.
Bug,QPID-561,12377259,c++ broker using incorrect value for xa-ok.,,aconway,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,"The qpidd broker uses the constant XA_OK=8, but the 0-10 XML defines xa-ok=0. The value 8 looks like a 0-9 throwback.
It appears that python uses the incorrect value also, since changing it to - broke the python xa tests with the broker.

constants.h now provides generated C++ constants for all AMQP constants define in XML, we should replace all hand-written constants with constants based on the generated ones."
Bug,QPID-52,12353771,"C++ build fails on RHEL 4, unordered_map not available.",aconway,aconway,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,"c++ broker no longer builds on RHEL4. In 
particular the <tr1/memory> & <tr1/unordered_map> includes in FieldTable 
were causing errors"
Bug,QPID-4435,12615969,Reconnect on connect failure hangs at third address to try,astitcher,astitcher,Closed,Fixed,2012-11-13 22:19,Broker,Client,NONE,"Necessary conditions to trigger hang:

* You are connecting to a name that resolves to 3 or more underlying network addresses.
* The first 2 addresses refuse the connection (there is no daemon listening on the appropriate port at that address).

In this case the client will attempt to connect to the third resolved address, but will hang forever waiting.

If you look at a server log that is listening on the third address then you will eventually see:
   ... error Connection ... No protocol received closing
because the server has received the connection and made the initial reply but has not heard back in the alloted time."
Bug,QPID-982,12394996,C++ rubygen code generator sensitive to ruby version.,,aconway,Closed,Fixed,2012-09-18 22:33,Broker,Client,NONE,"ruby generator does not work with some 1.8.6 versions of ruby, as discussed on qpid-dev:

> On Tue, Apr 29, 2008 at 1:41 PM, Gordon Sim <gsim@redhat.com> wrote:
> 
>> Senaka Fernando wrote:
>>
>>> My version of ruby is,
>>>
>>> ruby 1.8.6 (2007-06-07 patchlevel 36) [i486-linux]
>>>
>> The problem does appear to be related to ruby version. Arnaud hit the same
>> problem with 1.8.6.111 and on upgrading to 1.8.6.114 the problem went away
>> and the files were generated as expected.
>>"
Bug,QPID-3004,12495825,Qpid does not compile cleanly with clang++ compiler (2.8),,astitcher,Closed,Fixed,2011-05-09 21:05,Broker,Client,Clustering,"The Clang project C++ compiler has got to the point where it can now compile the qpid C++ code.

There are some advantages of using this compiler over the GCC compiler that we've previously been using for Unix compiles:
  Much better error messages:
  Faster compiles
and of course there are disadvantages too.

In general I believe there is no portable code just ported code, but code that compiles under the most environments will naturally be the most portable and I'd assert the most bug free too. Therefore I think it is to the benefit of the Qpid if we get the C++ code to compile under clang++ too.

Currently there appear to be a vast number of warnings of the form:

In file included from ../../src-working/cpp/src/qpid/client/SessionImpl.h:35:
./qpid/framing/AMQP_ClientOperations.h:54:30: warning: extra ';' inside a class [-pedantic]
        ConnectionHandler(){};
                             ^

[You'll note that there is an indicator of where in the line the error occurs too as well as just the line no. - the variable pitch font messes it up though]

And there are some smaller number of actual compile errors."
Bug,QPID-2916,12478587,C++ broker & Python client will silently truncate strings whose length is greater than the max length supported by the type.,kgiusti,kgiusti,Closed,Fixed,2010-10-28 21:41,Broker,Client,NONE,"While testing QMF, I attempted to send a string of length > 255 bytes as a str8.  Both the broker and the python client will encode the string by either truncating it, or incorrectly truncating the length."
Bug,QPID-1722,12416469,Use of gethostbyname() in Socket.cpp isn't thread safe,astitcher,astitcher,Closed,Fixed,2009-03-09 21:22,Broker,Client,NONE,"Using gethostbyname() like this in multiple threads at once (for instance connecting simultaneously) may cause client/broker crashes

The best fix is to replace the old API used with the re-entrant and more featureful getaddrinfo() API
"
Bug,QPID-7860,13087239,[cpp] Build produces deprecation warnings on recent Fedora,jross,jross,Resolved,Fixed,2017-10-27 14:17,Broker,Client,NONE,"{noformat}
-- Found SWIG: /usr/bin/swig (found version ""3.0.11"") 
-- Found PythonLibs: /usr/lib64/libpython2.7.so (found version ""2.7.13"") 
-- Found Perl: /usr/bin/perl (found version ""5.24.1"") 
-- Found PerlLibs: /usr/lib64/libperl.so (found version ""5.24.1"") 
-- Building Python bindings
CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qpid/python/CMakeLists.txt:35 (swig_add_module)


CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qmf2/python/CMakeLists.txt:35 (swig_add_module)


-- Building Ruby bindings
CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qpid/ruby/CMakeLists.txt:48 (swig_add_module)


CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qmf2/ruby/CMakeLists.txt:39 (swig_add_module)


-- Building Perl bindings
CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qpid/perl/CMakeLists.txt:31 (swig_add_module)


-- Configuring done
-- Generating done
-- Build files have been written to: /home/jross/code/qpid-cpp/bld
{noformat}"
Bug,QPID-6661,12849576,[AMQP 1.0] heartbeat anomalies,gsim,gsim,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"The first heartbeat is often sent after the full idle period, whereas subsequent heartbeats are sent twice as frequently. This happens on both broker and client. This is a result of the periodic timer task that triggers the heartbeats being out of sync with the times computed by proton.

Also on the client, occasionally a heartbeat is missed. This is in part due to the issue above, but also occasionally due to timing of incoming heartbeats with respect to the timer task, resulting in proton emitting the heartbeat but it not actually being written to the wire."
Bug,QPID-5609,12699387,QPID fails to compile in C++11 with Boost 1.54 ,,andyrobo60,Closed,Fixed,2014-04-02 21:40,Broker,Client,NONE,"QPID fails to compile with GCC 4.8.2 and Boost 1.54 in C+\+11 using the compiler flag ""-std=c++11"". 

This problem is caused by a change to Boost's shared_ptr. When compiling in c+\+11 the shared_pointer interface is changed to match c++11's std::shared_pointer. This causes the boolean conversion operator to be made explicit, preventing the implicit conversion to a boolean when returning a shared_ptr from a function. 

To get QPID to compile with GCC 4.8.2 and C+\+11 extra compiler flags are needed. After running CMake modify the CMakeCache.txt file and set the variable ""CMAKE_CXX_FLAGS"" to ""-std=c+\+11 -Wno-unused-local-typedefs -Wno-ignored-qualifiers -Wno-deprecated-declarations"". Passing the variable to CMake on the command line can cause problems as CMake doesn't like the '=' in the flag ""-std=c+\+11""."
Bug,QPID-5304,12677898,Unit test program has bad failure mode if XML_LIB is not set,astitcher,astitcher,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"If you have built the xml exchange, then it is impossible to just run the unit test program manually without at least setting XML_LIB as the program will abort very early on.

This is particularly annoying if you just want to test something unrelated quickly."
Bug,QPID-1745,12417105,C++ Windows; IntegerTypes.h need not define size_t,shuston,shuston,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"The qpid/cpp/src/qpid/sys/windows/IntegerTypes.h file typedefs size_t. This is not necessary for VC9, and the definition conflicts with the proper def for 64-bit builds. Removing the typedef for size_t works for both 32- and 64-bit builds."
Bug,QPID-3282,12508470,Potential bug when checking socket connections for identical local and remote endpoint,astitcher,astitcher,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Currently there is a check in Socket::connect that tries to make sure we don't try to connect to the same endpoint that the local end is bound to, this can happen in rare circumstances when connecting to localhost when the OS decides to bind the local end to a port that has just been given up by an exiting application that we are just about to retry connecting to.

However the existing test doesn't canonicalise the endpoint names so it might try to do a string compare of ""localhost:1234"" with ""127.0.0.1:1234"" and fail even though it should succeed."
Bug,QPID-3035,12497573,Removing a sequence number from a SequenceSet can corrupt the sequence.,kgiusti,kgiusti,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Given a SequenceSet with disjoint sub-sequences, deleting from the end of one sequence will corrupt a following sequence (if present).  

Example - given the following sequence:

{[1,6] [10,20]}

deleting the sequence ""6"" will result in the following:

{[1,5] [7,20]}

the trailing subsequence now incorrectly includes 7-9."
Bug,QPID-1068,12396261,C++ configure fails if help2man not present,astitcher,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Recent email suggested that help2man is not really a requirement for configuring/building the C++ code, and if it's not present, the man pages should not be generated. However, if help2man is  not present, the configure fails. This patch fixes that - if help2man is not present, the docs/man directory is not built."
Bug,QPID-557,12376706,Clean  up all avoidable valgrind issues ,,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"qpid/cpp/src/tests/.valgrind.supp-default suppresses a bunch of leaks and other errors. They appear to be harmless but most can probably be avoided by minor rework of the code. Clean up all the avoidable issues and trim the suppressions file down to the bare minimum of unavodiable errors harmless error reports, annotate each error remaining with comments explaining why it is harmless.
"
Bug,QPID-1993,12430897,"Solved the ""ignoring return value"" error",gsim,chenta,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Every time I get the latest source code from the repository. The compiler always complain about ignoring return value. 
The original trick to suppress this warning seems ok. But maybe the recent version of gcc doesn't accept this trick anymore. So I decide to use a temporary variable to handle this problem."
Bug,QPID-3638,12532354,incompatibility with new boost version 1.48,tross,nsantos,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"qpid/log/Logger.cpp:26:43: fatal error: boost/pool/detail/singleton.hpp: No such file or directory

Looks like the code under boost/pool has been re-organized in version 1.48, and that file no longer exists."
Bug,QPID-4669,12639142,require proton 0.3 or greater,gsim,gsim,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,0.2 is too out of date and qpidc won't compile against it.
Bug,QPID-117,12356194,C++ code won't build on Ubuntu due to assumptions about where apr headers live,aconway,astitcher,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,"The C++ code includes apr headers using ""apr-1/apr_..."" this doesn't generally work as the spr headers need not be in a subdirectory called this. Indeed under Ubuntu they are in a directory called apr-1.0.

The solution is to follow the normal include usage for apr and just include ""apr_,,,""."
Bug,QPID-296,12360537,C++ Header guards may not be compliant with C++ standard,kpvdr,astitcher,Closed,Fixed,2013-07-29 13:58,Broker,Client,NONE,"According to the C++ standard symbols that have a single ""_"" followed by an uppercase
letter and symbols starting with ""__"" (double underscore are reserved for the implementer (That is usually the
compiler/library writer). 

There are numerous header files with guards that violate this standard in the C++ source base."
Bug,QPID-1069,12396267,Patch to build trunk with Boost 1.35,astitcher,shuston,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"Trunk C++ code fails to build with Boost 1.35 - there's a missing Boost feature prior to 1.35 that is now available. This patch allows C++ trunk code to build with Boost 1.35.
Index: Blob.h
===================================================================
--- Blob.h      (revision 657445)
+++ Blob.h      (working copy)
@@ -27,6 +27,7 @@
 #include <boost/utility/typed_in_place_factory.hpp>
 #include <boost/type_traits/is_base_and_derived.hpp>
 #include <boost/utility/enable_if.hpp>
+#include <boost/version.hpp>

 #include <new>

@@ -39,7 +40,8 @@
 using boost::in_place;
 using boost::typed_in_place_factory_base;

-/** 0-arg typed_in_place_factory, missing in boost. */
+/** 0-arg typed_in_place_factory, missing in pre-1.35 boost. */
+#if (BOOST_VERSION < 103500)
 template <class T>
 struct typed_in_place_factory0 : public typed_in_place_factory_base {
     typedef T value_type ;
@@ -49,6 +51,7 @@
 /** 0-arg in_place<T>() function, missing from boost. */
 template<class T>
 typed_in_place_factory0<T> in_place() { return typed_in_place_factory0<T>(); }
+#endif

 template <class T, class R=void>
 struct EnableInPlace
"
Bug,QPID-5646,12703761,Can't build against any released version of proton,astitcher,gsim,Closed,Fixed,2014-06-03 15:34,Broker,Client,NONE,"as a result of changes for QPID-5631.

Both trunk and beta need to be able to build against a released version of proton."
Bug,QPID-5488,12689352,Apparent corruption of SSL connection,astitcher,jross,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,ssl_test fails.  See attached output for details.
Bug,QPID-5445,12686235,Make install writes to OS-reserved location despite setting prefix,mcpierce,jross,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"The qmfgen install ignores the install prefix.  An unprivileged install will fail:

http://people.apache.org/~jross/qpid-cpp-0.26-rc2-make-install-to-prefix.txt

Worse, a privileged install can overwrite system-installed code."
Bug,QPID-2674,12467117,heartbeats can cause seg faults under tcp on linux,astitcher,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"If there is a queued callback that is processed during a writeable
event (or read-writeable) the writeable callback, i.e. AsynchIO::writeable(), takes the path through
line 536 of AsyncIO.cpp, then AsynchIOHandler::closedSocket() is called
which deletes the AsynchIOHandler instance, the thread then goes on to process the callbacks in DipatchHandle, which invoke on the now deleted AsynchIOHandler.

Results in cores like:

Core was generated by `/home/gordon/qpid/cpp/build/src/.libs/lt-qpidd
--load-module /home/gordon/qpid/'.
Program terminated with signal 11, Segmentation fault.
[New process 9483]
[New process 9516]
[New process 9490]
[New process 9489]
[New process 9488]
[New process 9487]
[New process 9486]
[New process 9484]
#0  0x00002aaefd5e999d in qpid::sys::AsynchIOHandler::disconnect
(this=0x1a4f0880) at ../../src/qpid/sys/AsynchIOHandler.cpp:194
194     if (codec) codec->closed();
(gdb) bt
#0  0x00002aaefd5e999d in qpid::sys::AsynchIOHandler::disconnect
(this=0x1a4f0880) at ../../src/qpid/sys/AsynchIOHandler.cpp:194
#1  0x00002aaefd5e9c29 in qpid::sys::AsynchIOHandler::eof (this=0x2aaab1b330c0,
a=@0x1a8778a0) at ../../src/qpid/sys/AsynchIOHandler.cpp:177
#2  0x00002aaefd51ccbf in boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#3  0x00002aaefd51c873 in
boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void,
boost::_mfi::mf1<void, qpid::sys::posix::AsynchIO, boost::function1<void,
qpid::sys::AsynchIO&, std::allocator<boost::function_base> > >,
boost::_bi::list2<boost::_bi::value<qpid::sys::posix::AsynchIO*>,
boost::_bi::value<boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> > > > >, void,
qpid::sys::DispatchHandle&>::invoke (function_obj_ptr=<value optimized out>,
a0=<value optimized out>) at /usr/include/boost/bind/mem_fn_template.hpp:149
#4  0x00002aaefd5ee49f in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#5  0x00002aaefd5ed2b6 in qpid::sys::DispatchHandle::processEvent
(this=0x1a8778a8, type=qpid::sys::Poller::READ_WRITABLE)
    at ../../src/qpid/sys/DispatchHandle.cpp:309
#6  0x00002aaefd526e98 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/Poller.h:125
#7  0x00002aaefd0844e4 in qpid::broker::Broker::run (this=<value optimized
out>) at ../../src/qpid/broker/Broker.cpp:339
#8  0x0000000000409014 in QpiddDaemon::child (this=0x7fff989850d0) at
../../src/posix/QpiddBroker.cpp:130
#9  0x00002aaefd0a482f in qpid::broker::Daemon::fork (this=0x7fff989850d0) at
../../src/qpid/broker/Daemon.cpp:91
#10 0x0000000000407585 in QpiddBroker::execute (this=<value optimized out>,
options=<value optimized out>) at ../../src/posix/QpiddBroker.cpp:168
#11 0x00000000004057ff in main (argc=12, argv=0x7fff989856b8) at
../../src/qpidd.cpp:80
(gdb) print codec
$1 = (class qpid::sys::ConnectionCodec *) 0x2aaab1b330c0
(gdb) thread apply all bt

Thread 8 (process 9484):
#0  0x00000038f9c92149 in strftime_l () from /lib64/libc.so.6
#1  0x00002aaefd51f111 in qpid::sys::outputFormattedNow (o=@0x413214b0) at
../../src/qpid/sys/posix/Time.cpp:89
#2  0x00002aaefd5da5a1 in qpid::log::Logger::log (this=0x2aaefd895680,
s=@0x2aaefd894d80, msg=@0x41321770) at ../../src/qpid/log/Logger.cpp:77
#3  0x00002aaefd5dfa9c in qpid::log::Statement::log (this=0x2aaefd894d80,
message=@0x41321f90) at ../../src/qpid/log/Statement.cpp:57
#4  0x00002aaefd5f3b4b in qpid::sys::Timer::run (this=0x19b59b40) at
../../src/qpid/sys/Timer.cpp:129
#5  0x00002aaefd51f14a in runRunnable (p=0x413213f0) at
../../src/qpid/sys/posix/Thread.cpp:35
#6  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#7  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 7 (process 9486):
#0  0x00000038fa40ad09 in pthread_cond_wait@@GLIBC_2.3.2 () from
/lib64/libpthread.so.0
#1  0x00002aaefd5f3b73 in qpid::sys::Timer::run (this=0x19b5f490) at
../../include/qpid/sys/posix/Condition.h:63
#2  0x00002aaefd51f14a in runRunnable (p=0x19b5f4c4) at
../../src/qpid/sys/posix/Thread.cpp:35
#3  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#4  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 6 (process 9487):
#0  0x00000038f9cd4018 in epoll_wait () from /lib64/libc.so.6
#1  0x00002aaefd526343 in qpid::sys::Poller::wait (this=0x19b4ee00,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:570
#2  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#3  0x00002aaefd51f14a in runRunnable (p=0x5) at
../../src/qpid/sys/posix/Thread.cpp:35
#4  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#5  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 5 (process 9488):
#0  0x00000038f9cd3f9a in epoll_ctl () from /lib64/libc.so.6
#1  0x00002aaefd525fd7 in qpid::sys::PollerPrivate::resetMode (this=0x19b593a0,
eh=@0x2aaab4090920) at ../../src/qpid/sys/epoll/EpollPoller.cpp:389
#2  0x00002aaefd52624d in qpid::sys::Poller::wait (this=0x19b4ee00,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:558
#3  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#4  0x00002aaefd51f14a in runRunnable (p=0x5) at
../../src/qpid/sys/posix/Thread.cpp:35
#5  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#6  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 4 (process 9489):
#0  0x00000038f9cd447b in accept () from /lib64/libc.so.6
#1  0x00002aaefd511ca4 in qpid::sys::Socket::accept (this=<value optimized
out>) at ../../src/qpid/sys/posix/Socket.cpp:215
#2  0x00002aaefd51a085 in qpid::sys::posix::AsynchAcceptor::readable
(this=0x19b634b0, h=@0x19b634d0) at ../../src/qpid/sys/posix/AsynchIO.cpp:121
#3  0x00002aaefd5ee49f in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() (this=0x157, a0=@0x0)
    at /usr/include/boost/function/function_template.hpp:576
---Type <return> to continue, or q <return> to quit---
#4  0x00002aaefd5ed1f9 in qpid::sys::DispatchHandle::processEvent
(this=0x19b634d0, type=qpid::sys::Poller::READABLE)
    at ../../src/qpid/sys/DispatchHandle.cpp:278
#5  0x00002aaefd526e98 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/Poller.h:125
#6  0x00002aaefd51f14a in runRunnable (p=0x13) at
../../src/qpid/sys/posix/Thread.cpp:35
#7  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#8  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 3 (process 9490):
#0  0x00000038f9cd3f9a in epoll_ctl () from /lib64/libc.so.6
#1  0x00002aaefd525fd7 in qpid::sys::PollerPrivate::resetMode (this=0x19b593a0,
eh=@0x2aaab40dc910) at ../../src/qpid/sys/epoll/EpollPoller.cpp:389
#2  0x00002aaefd52624d in qpid::sys::Poller::wait (this=0x19b4ee00,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:558
#3  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#4  0x00002aaefd51f14a in runRunnable (p=0x5) at
../../src/qpid/sys/posix/Thread.cpp:35
#5  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#6  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 2 (process 9516):
#0  0x00000038f9cd4018 in epoll_wait () from /lib64/libc.so.6
#1  0x00002aaefd526343 in qpid::sys::Poller::wait (this=0x19b65e60,
timeout=<value optimized out>) at ../../src/qpid/sys/epoll/EpollPoller.cpp:570
#2  0x00002aaefd526ea7 in qpid::sys::Poller::run (this=0x19b65e60) at
../../src/qpid/sys/epoll/EpollPoller.cpp:517
#3  0x00002aaefd51f14a in runRunnable (p=0x14) at
../../src/qpid/sys/posix/Thread.cpp:35
#4  0x00000038fa406617 in start_thread () from /lib64/libpthread.so.0
#5  0x00000038f9cd3c2d in clone () from /lib64/libc.so.6

Thread 1 (process 9483):
#0  0x00002aaefd5e999d in qpid::sys::AsynchIOHandler::disconnect
(this=0x1a4f0880) at ../../src/qpid/sys/AsynchIOHandler.cpp:194
#1  0x00002aaefd5e9c29 in qpid::sys::AsynchIOHandler::eof (this=0x2aaab1b330c0,
a=@0x1a8778a0) at ../../src/qpid/sys/AsynchIOHandler.cpp:177
#2  0x00002aaefd51ccbf in boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#3  0x00002aaefd51c873 in
boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void,
boost::_mfi::mf1<void, qpid::sys::posix::AsynchIO, boost::function1<void,
qpid::sys::AsynchIO&, std::allocator<boost::function_base> > >,
boost::_bi::list2<boost::_bi::value<qpid::sys::posix::AsynchIO*>,
boost::_bi::value<boost::function1<void, qpid::sys::AsynchIO&,
std::allocator<boost::function_base> > > > >, void,
qpid::sys::DispatchHandle&>::invoke (function_obj_ptr=<value optimized out>,
a0=<value optimized out>) at /usr/include/boost/bind/mem_fn_template.hpp:149
#4  0x00002aaefd5ee49f in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() (this=0x2aaefd5e9c20, 
    a0=@0x1a8778a0) at /usr/include/boost/function/function_template.hpp:576
#5  0x00002aaefd5ed2b6 in qpid::sys::DispatchHandle::processEvent
(this=0x1a8778a8, type=qpid::sys::Poller::READ_WRITABLE)
    at ../../src/qpid/sys/DispatchHandle.cpp:309
#6  0x00002aaefd526e98 in qpid::sys::Poller::run (this=0x19b4ee00) at
../../src/qpid/sys/Poller.h:125
#7  0x00002aaefd0844e4 in qpid::broker::Broker::run (this=<value optimized
out>) at ../../src/qpid/broker/Broker.cpp:339
#8  0x0000000000409014 in QpiddDaemon::child (this=0x7fff989850d0) at
../../src/posix/QpiddBroker.cpp:130
#9  0x00002aaefd0a482f in qpid::broker::Daemon::fork (this=0x7fff989850d0) at
../../src/qpid/broker/Daemon.cpp:91
---Type <return> to continue, or q <return> to quit---
#10 0x0000000000407585 in QpiddBroker::execute (this=<value optimized out>,
options=<value optimized out>) at ../../src/posix/QpiddBroker.cpp:168
#11 0x00000000004057ff in main (argc=12, argv=0x7fff989856b8) at
../../src/qpidd.cpp:80
(gdb)    "
Bug,QPID-2086,12435128,intermittent federated cluster hangs since r810591,aconway,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"On revision 810590 I can run federated_cluster_test_with_node_failure in a loop for over 100 iterations without any hangs.

However on revision 810591 the same loop hangs quite easily (generally within 10 runs or so). "
Bug,QPID-4579,12631962,Fails to build from source with GCC 4.8.0,mcpierce,mcpierce,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"The compiler error seen is:

In file included from ./qpid/framing/FrameHandler.h:23:0,
                 from ./qpid/framing/Proxy.h:22,
                 from qpid/framing/Proxy.cpp:19:
./qpid/framing/Handler.h:52:47: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     template <class F> class Functor : public Handler<T> {
                                               ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^
./qpid/framing/Handler.h:64:30: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     class MemFunRef : public Handler<T> {
                              ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^
cc1plus: all warnings being treated as errors
make[3]: *** [qpid/framing/Proxy.lo] Error 1
In file included from ./qpid/framing/FrameHandler.h:23:0,
                 from ./qpid/framing/InputHandler.h:24,
                 from ./qpid/framing/amqp_framing.h:28,
                 from ./qpid/framing/SendContent.h:22,
                 from qpid/framing/SendContent.cpp:22:
./qpid/framing/Handler.h:52:47: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     template <class F> class Functor : public Handler<T> {
                                               ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^
./qpid/framing/Handler.h:64:30: error: invalid use of incomplete type 'struct qpid::framing::Handler<T>' [-Werror]
     class MemFunRef : public Handler<T> {
                              ^
./qpid/framing/Handler.h:32:8: error: declaration of 'struct qpid::framing::Handler<T>' [-Werror]
 struct Handler {
        ^"
Bug,QPID-3338,12513092,qpidxarm CMake target is missing in 0-12,cliffjansen,cliffjansen,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"cpp/src/CMakeLists.txt was altered for mingw builds in QPID-2905 (r1104662).

The qpidxarm target builds the XA distributed transaction resource manager for use with the Microsoft distributed trasanction coordinator.  It was targeted for Windows builds only, using the CMake variable ""WIN32"".

This variable was changed to ""_MSC_VER"" for QPID-2905, presumably to indicate that the build target should only apply to builds using the Microsoft compiler, and not mingw.  Unfortunately ""_MSC_VER"" is not a recognized CMAKE variable and the qpidxarm target is never generated.

The CMake documentation indicates the the variable ""MSVC"" should be used to indicate The Microsoft compiler compared to mingw.
"
Bug,QPID-3586,12530360,Changes for QPID-3464 break cmake build in tar.gz distribution,astitcher,astitcher,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,The changes to the cmake build system in QPID-3464 added some new cmake build files however they weren't added to the autotools list of files to distribute. As it's autotools that creates the .tar.gz this means that the distribution doesn't have all teh files for the cmake build.
Bug,QPID-1525,12410405,Missing pure virtual method in Windows AsynchIO.cpp,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,svn rev 724233 added a pure virtual method to qpid/sys/AsynchIO.h which was not added to qpid/sys/windows/AsynchIO.cpp. This causes the common lib compile to fail. Must be fixed for M4.
Bug,QPID-4345,12609110,Windows memory leak,cliffjansen,kbonin,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,In our large system performance test environments we see Broker memory growth until the process crashes.  This appears to be reproducible simply by opening and closing connections as fast as possible.  Marked as 'Blocker' as it was blocking shipment of our Windows based product - the Broker would exhaust memory and crash itself every few days of operation.
Bug,QPID-1546,12411098,M4 RC5 Windows Visual Studio files munged,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"The Visual Studio project files for the C++ build had some licensing inserted and the line endings changed to Unix. These made them unusable by Visual Studio, so they won't load. I can change the line endings to DOS easily enough, but does the Apache license have to be included in the project files (*.vcproj)? If so, can it go further down the file (right now it's right at the top and Visual Studio screams about it).

I'll fix these things Monday 22-Dec-08 if I can get clarification about the license placement."
Bug,QPID-6470,12787068,FieldValue::getFloatingPointValue() converts endian each time it is called,aconway,pokutnev,Closed,Fixed,2016-09-08 10:26,Broker,Client,Clustering,"When calling getFloatingPointValue multiple times, the octets are endian-converted each time.
Actually we need to make a copy first and then call convertIfRequired()."
Bug,QPID-986,12395058,Need to link libuuid.a to libqpidbroker.so and libqpidclient.so in Qpid/C++,,danushka,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,"When I try to compile a repository working copy of Qpid/C++ I get a build error saying that there are undefined references to ""uuid_generate"" in both libqpidbroker.so and libqpidclient.so. When I was going through the makefile I found that libuuid.a is not linked to these two libs and I could easily get rid of the issue simply by modifying the makefile to link libuuid.a to these two libs."
Bug,QPID-488,12369102,Concurrent access to apr_pools (which are not thread safe),astitcher,gsim,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,The c++ codebase is now set to share an apr pool per process which is a problem as apr_pools are not thread safe.
Bug,QPID-7669,13042093,Unintended UI changes from switch to swigged Python client for management tools,aconway,jross,Resolved,Fixed,2017-11-22 9:54,Broker,Client,NONE,http://qpid.2158936.n2.nabble.com/Qpid-tools-with-python-vs-qpid-cpp-messaging-td7659017.html
Bug,QPID-7494,13017863,Invocation of check_dependencies.py fails on CMake 2.8.11,jross,jross,Resolved,Fixed,2016-11-04 0:07,Broker,Client,NONE,"This annoying issue is discussed here: https://public.kitware.com/Bug/view.php?id=13887 .

It's a bug introduced in cmake 2.8.10 and resolved in 2.8.12.  RHEL 7's cmake version is 2.8.11."
Bug,QPID-6966,12924892,C++ broker and client to support TLS1.1 and TLS1.2 by default,pmoravec,pmoravec,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"Description of problem:
Currently, neither C++ client or broker allows TLS1.1 or TLS1.2 protocol versions. Please enable it, esp. since Java client 6.1 will disable TLS1.0 and use 1.1 and 1.2 only.


Version-Release number of selected component (if applicable):
qpid-cpp-server-0.34-5.el6.x86_64
qpid-cpp-client-0.34-5.el6.x86_64


How reproducible:
100%


Steps to Reproduce:
1. Start qpid broker with SSL configured
2. openssl s_client -tls1_1 -connect localhost:5671
3. openssl s_client -tls1_2 -connect localhost:5671


Actual results:
Both 2 and 3 fails with:

{noformat}
139817551390536:error:1408F10B:SSL routines:SSL3_GET_RECORD:wrong version number:s3_pkt.c:337:
{noformat}


Expected results:
Both should return something like:

{noformat}
CONNECTED(00000003)
depth=0 CN = localhost
verify error:num=18:self signed certificate
verify return:1
depth=0 CN = localhost
verify return:1
140319888385864:error:14094412:SSL routines:SSL3_READ_BYTES:sslv3 alert bad certificate:s3_pkt.c:1256:SSL alert number 42
140319888385864:error:1409E0E5:SSL routines:SSL3_WRITE_BYTES:ssl handshake failure:s3_pkt.c:596:
---
Certificate chain
 0 s:/CN=localhost
   i:/CN=localhost
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIBoDCCAQmgAwIBAgIFAKUDcMswDQYJKoZIhvcNAQEFBQAwFDESMBAGA1UEAxMJ
bG9jYWxob3N0MB4XDTE1MTIzMDExMDYwN1oXDTE2MDMzMDExMDYwN1owFDESMBAG
A1UEAxMJbG9jYWxob3N0MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCgCq6w
o6FW7gIpAQu8y74wuREH6aGo6hc6YVfATz503o7dxqmUUKs6+DkqbEiDu43r51QL
Sb7oduLMmrvC5TfhWEZGe3PYPOuCBbpqDxXs5kKlqSCuIbvDv1ua1WXdqb27/jGr
d6Lf+DsnU+GXrGwLY1W1zchagmFU1P2dLh8JhQIDAQABMA0GCSqGSIb3DQEBBQUA
A4GBACUauXrJB/P0za8mPj5As4uQ3kr7CHIAtFBEAd3MvVmf9RHniMU/resXeE1B
CBOZ4kXmTvVQ+/kDxYTXO/pLq0wh4HHuZC4LrmlIHG2WagEskVnYgqJiHUchKi+8
URu/CX4rW6/EdcAHhPsKX6nlHFFKYg5u9b9ZtQHYMrfryStZ
-----END CERTIFICATE-----
subject=/CN=localhost
issuer=/CN=localhost
---
Acceptable client certificate CA names
/CN=dummy
---
SSL handshake has read 565 bytes and written 202 bytes
---
New, TLSv1/SSLv3, Cipher is AES128-GCM-SHA256
Server public key is 1024 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : AES128-GCM-SHA256
    Session-ID: 7D6C1CB53B37700F2BF007D0D079AB72F26A9D289BCA8D98B5B3F1E283311991
    Session-ID-ctx: 
    Master-Key: 448215BEAADBFF90B82B421D182F8AD7174426D9292835775C405A7C3AEC2763E5F2A1127E5AE210ADC6B7335EE1F6FA
    Key-Arg   : None
    Krb5 Principal: None
    PSK identity: None
    PSK identity hint: None
    Start Time: 1451483784
    Timeout   : 7200 (sec)
    Verify return code: 18 (self signed certificate)
---
{noformat}

Additional info:"
Bug,QPID-7393,12996942,Unavailable buffers in Windows SSL,cliffjansen,cliffjansen,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"From the user list (acartcat Cartwright_Andrew@cat.com):

> I get the following error in the broker, looks like the same error as
> QPID-5033.
[...]
> 2016-05-26 05:22:23 [System] error No IO buffers available: getQueuedBuffer
> with empty queue. Debug data: 0 1 0 3 0 0 1
[...]
> This can be triggered on demand using:
> qpid-send -b ssl:XXXXXXXX.com:5671 --connection-options {protocol:amqp1.0}
> -a testerq --content-string=hello --messages 200

In my testing, qpid-send must also be Windows based.  I do not see the error
if it is sent from a client running on Linux.

This error is caused by the SChannel driver generating (valid but
useless) empty SSL packets when a zero length write is requested from
the codec on the client side.  On the server side, these are
processed and empty read callbacks are generated, even after close.

The WSAENOBUFS happens as a side effect of recursive calls to
sslDataIn while processing adjacent empty packets.

"
Bug,QPID-7145,12950854,auto_ptr is deprecated from C++11 and onwards and its use causes a warning with GCC 6,astitcher,astitcher,Closed,Fixed,2016-09-06 21:32,Broker,Client,Clustering,"As we compile qpid with warnings turned to errors this causes the build to fail by default when compiling with GCC6.

The simplest ""fix"" is just to turn of deprecation warnings.

A better fix would be to stop using auto_ptr. An good alternative in the context of qpid would be boost::scoped_ptr.

If we change the base C++ version for qpid we could use std::unique_ptr instead."
Bug,QPID-7302,12979297,race between auto-delete and re-declare/consume ,gsim,gsim,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"In AMQP 0-10, declare and consume are two distinct operations. When creating a receiver through qpid::messaging, we first declare then consume from the queue.

For a timed auto-delete queue, the delayed auto-delete can tae place between the declare and the consume, resulting in a session error. It would be nice to avoid this. The workaround of course is to set the delay for auto-delete to be sufficiently large that the client will either have reconnected or is likely not reconnecting.

However a simple solution would be to reset the timer on the declare, allowing time for the consume.

This does not prevent the race between a non-timed auto-delete triggered by one session and declare/consume from a different client connection."
Bug,QPID-6409,12776994,Taking address of a 0-length vector throws exception,shuston,shuston,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"In Debug-mode builds, std::vector in VS2013 will throw an exception if trying to do:  &argv[0]  if argv has 0 length. This construct happens in cpp/src/tests/BrokerFixture.h, so happens in many of the unit tests."
Bug,QPID-6511,12823911,"[C++ Broker, clients] AMQP 0-10 windows clients can not connect to --no-auth broker",chug,chug,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"Broker
{noformat}
./qpidd --auth no
{noformat}
Windows client
{noformat}
spout -b my-broker:5672 amq.topic
{noformat}
Fails with ""Not authenticated!""

The behavior change was in the broker as part of QPID-6325. Arguably the change is a good thing as it prevents clients connecting to the broker with no name. However, it makes for a poor out-of-the-box experience with a no-auth broker rejecting connections with an auth error. 

Clients can make a connection by adding:
{noformat}
--connection-options ""{username:dummy}""
or
--connection-options ""{sasl-mechanisms:ANONYMOUS}""
{noformat}
But the change breaks years of accumulated self tests that work just fine against older versions of qpidd.

The proposal to fix this is to make the Windows client provide the same connection defaults as linux cyrus sasl. "
Bug,QPID-6529,12827038,[C++ Client] Fails to compile with Proton 0.10,chug,chug,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"Proton version detection logic
{noformat}
if (Proton_VERSION GREATER 0.8)
{noformat}
gets it wrong when Proton is 0.10.
"
Bug,QPID-6399,12776036,Windows run_test.ps1 script needs revamp to match run_test,shuston,shuston,Closed,Fixed,2016-09-06 16:31,Broker,Client,NONE,"Some time back the run_test script was expanded to offer new capabilities and the cmake testing invocation changed to match. The run_test.ps1 script is still expecting ""old"" invocation and needs a makeover."
Bug,QPID-3540,12526463,"Typecasting and alignment requirements for various platforms - ""increases required alignment of target type""",,chug,Closed,Fixed,2015-06-16 8:35,Broker,Client,NONE,"On sparc/solaris (and others) the following code generates an error:

  qpid/cpp/src/qpid/RefCountedBuffer.cpp line 37
    boost::intrusive_ptr<RefCounted>(reinterpret_cast<RefCountedBuffer*>(store)),

A workaround is the '(void *)' hack that quiets the compiler but leaves the
code exposed to a run time fault if the store object is not properly aligned:

    boost::intrusive_ptr<RefCounted>(reinterpret_cast<RefCountedBuffer*>((void*)store)),

Another error shows up in
  
  qpid/cpp/src/tests/qpid-perftest.cpp line 647
    size_t n = *reinterpret_cast<const size_t*>(msg.getData().data() + offset);

The (void *) hack silences the error here, too, but the run time code is exposed to
a data alignment fault.

I propose that these two pieces of code need work to guarantee the alignment
or to work around any memory reference fault.

1. In the store case, new() probably returns an address that meets the alignment
requirement. An assert would help diagnose when this assumption fails.

2. In the qpid-perftest case the size_t could be extracted from the raw buffer
with a memcpy and that would be safe to do in all architectures.

2A. A separate issue is the fact that size_t changes between 32-bit and 64-bit
platforms, and that the size_t does not appear to be byte swapped for interop
between big and little endian systems. If these messages are consumed only
by the sender then no problem.


"
Bug,QPID-6021,12735090,[AMQP 1.0] Improve performance,gsim,gsim,Closed,Fixed,2015-03-19 12:23,Broker,Client,NONE,Performance is poorer when using AMQP 1.0  (as compared to using AMQP 0-10). This is a JIRA to highlight a few changes to improve things in the next release cycle.
Bug,QPID-6160,12748712,CLONE - [CPP Broker] [CPP Client] Disable SSLv3 support,kgiusti,kgiusti,Closed,Fixed,2015-03-19 12:23,Broker,Client,NONE,"SSLv3 is vulnerable to CVE-2014-3566, and will not fixed. 

Wherever a seure connection is established we should ensure that SSLv3 is not in the supported protocols."
Bug,QPID-6321,12768157,Can't build against latest 0.9,gsim,gsim,Closed,Fixed,2015-03-19 12:22,Broker,Client,NONE,Change to pn_delivery_tag_t breaks build.
Bug,QPID-6444,12781190,Build fails due to unused function warning,astitcher,astitcher,Closed,Fixed,2015-03-19 12:22,Broker,Client,NONE,"[0.32 RC fails to build with default instructions]

[59/254] Building CXX object src/CMake....dir/qpid/broker/amqp/Connection.cpp.o
FAILED: /usr/lib64/ccache/c++   -DXQ_EFFECTIVE_BOOLEAN_VALUE_HPP -D_IN_QPID_BROKER -Damqp_EXPORTS -fvisibility-inlines-hidden -Werror -pedantic -Wall -Wextra -Wno-shadow -Wpointer-arith -Wcast-qual -Wcast-align -Wno-long-long -Wvolatile-register-var -Winvalid-pch -Wno-system-headers -Woverloaded-virtual -O2 -g -DNDEBUG -fPIC -I/home/andrew/Work/qpid/src-released/qpid/cpp/src -I/home/andrew/Work/qpid/src-released/qpid/cpp/src/../include -Isrc -Isrc/../include -I/usr/include/nss3 -I/usr/include/nspr4    -pthread -MMD -MT src/CMakeFiles/amqp.dir/qpid/broker/amqp/Connection.cpp.o -MF src/CMakeFiles/amqp.dir/qpid/broker/amqp/Connection.cpp.o.d -o src/CMakeFiles/amqp.dir/qpid/broker/amqp/Connection.cpp.o -c /home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/broker/amqp/Connection.cpp
/home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/broker/amqp/Connection.cpp:457:13: error: ?˜std::string qpid::broker::amqp::{anonymous}::convert(pn_delivery_tag_t)??defined but not used [-Werror=unused-function]
 std::string convert(pn_delivery_tag_t in)
             ^
cc1plus: all warnings being treated as errors
[107/254] Building CXX object src/CMak...pid/messaging/amqp/AddressHelper.cpp.o
FAILED: /usr/lib64/ccache/c++   -DXQ_EFFECTIVE_BOOLEAN_VALUE_HPP -Dqpidmessaging_EXPORTS -fvisibility-inlines-hidden -Werror -pedantic -Wall -Wextra -Wno-shadow -Wpointer-arith -Wcast-qual -Wcast-align -Wno-long-long -Wvolatile-register-var -Winvalid-pch -Wno-system-headers -Woverloaded-virtual -O2 -g -DNDEBUG -fPIC -I/home/andrew/Work/qpid/src-released/qpid/cpp/src -I/home/andrew/Work/qpid/src-released/qpid/cpp/src/../include -Isrc -Isrc/../include -I/usr/include/nss3 -I/usr/include/nspr4    -pthread -fno-visibility-inlines-hidden -fvisibility=hidden -MMD -MT src/CMakeFiles/qpidmessaging.dir/qpid/messaging/amqp/AddressHelper.cpp.o -MF src/CMakeFiles/qpidmessaging.dir/qpid/messaging/amqp/AddressHelper.cpp.o.d -o src/CMakeFiles/qpidmessaging.dir/qpid/messaging/amqp/AddressHelper.cpp.o -c /home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/messaging/amqp/AddressHelper.cpp
/home/andrew/Work/qpid/src-released/qpid/cpp/src/qpid/messaging/amqp/AddressHelper.cpp:141:6: error: ?˜bool qpid::messaging::amqp::{anonymous}::contains(const List&, const string&)??defined but not used [-Werror=unused-function]
 bool contains(const Variant::List& list, const std::string& item)
      ^
cc1plus: all warnings being treated as errors
"
Bug,QPID-6069,12738917,Does not compile under C++11 on FreeBSD,astitcher,astitcher,Closed,Fixed,2014-09-26 21:40,Broker,Client,NONE,There are some small compile problems that have crept in over the 0.30 release cycle that prevent qpid from compiling with clang++ and libc++ under FreeBsd 10.
Bug,QPID-5886,12726451,C++  Broker OutgoingMessage change exposes Completion handle export issue on Windows,chug,chug,Closed,Fixed,2014-09-26 15:43,Broker,Client,NONE,"Windows builds have been failing mysteriously for me for a few weeks[1]. I found the issues/ QPID-5828 r1604952 changed OutgoingMessage such that the Completion object now needs to access Handle<CompletionImpl>::isValid().

Simply instantiating the Handle superclass (r1525706 for example) didn't work. On windows the classes won't export from a .h file but need to come from .cpp files. Review is coming up shortly.

[1] Why some builds work and some don't is unsolved."
Bug,QPID-5865,12724737,The client and broker heartbeat code can get confused when the system time changes,astitcher,astitcher,Closed,Fixed,2014-09-26 15:42,Broker,Client,NONE,"The underlying timekeeping code in C++ qpid currently uses CLOCK_REALTIME which is related to wallclock time and can go backwards and skip time forwards (either due to NTP or administrator action).

This is not ideal because it can cause false timeouts to occur based on the system time rather than elapsed time.

It would be better for most timing to be based on CLOCK_MONOTONIC which is steadily increasing time based on the system uptime. That will avoid problems due to the system time changing."
Bug,QPID-5395,12682891,[AMQP 1.0] direct proton tracing into qpids own logging,gsim,gsim,Closed,Fixed,2014-06-03 15:35,Broker,Client,NONE,At present protons tracing is entirely distinct from qpidcpp's logging (whether qpidd or qpid:messaging). This means you can't direct the tracing to a file or to syslog. Traces from concurrent connections often get interleaved making them very hard to read.
Bug,QPID-5384,12682381,[AMQP 1.0] can't assert on autodelete property,gsim,gsim,Closed,Fixed,2014-06-03 15:35,Broker,Client,NONE,this is a result of it actually being communicated as a lifetime-policy (at least in the case of queues)
Bug,QPID-5427,12685124,It is possible to mask critical logging messages,astitcher,astitcher,Closed,Fixed,2014-06-03 15:35,Broker,Client,NONE,"As far as I understand it the entire point of log messages at the ""critical"" level is that they cannot be turned off at all. That is what critical means - the user *must* be informed of the confition being logged.

Unfortunately for a little while now it has been possible to turn all log levels off by specifying ""--log-disable trace+"" or using ""--log-enable !trace+"".
"
Bug,QPID-5658,12706289,C++ code not compiling with libc++,astitcher,astitcher,Closed,Fixed,2014-06-03 15:34,Broker,Client,NONE,FreeBSD 10 now uses a new compiler/library chain as default. The new C++ standard library has some small differences than the GNU C++ standard library.
Bug,QPID-5659,12706291,C++ not compiling (correctly) as C++11,astitcher,astitcher,Closed,Fixed,2014-06-03 15:34,Broker,Client,NONE,"In order to avoid a compile bug with libc++ and boost you have to compile qpid as C++11 under FreeBSD 10.

The current qpid code needs some small adjustments to compile correctly as C++11"
Bug,QPID-5232,12673855,[AMQP 1.0] receiver links from exchanges should be unreliable by default,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,and also use autodelete queues by default.
Bug,QPID-5146,12669621,[AMQP 1.0] capabilities not handled correctly,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,If there is more than one capability it should be sent as an array of symbols. Need to be able to read capabilities as either an array or a single symbol.
Bug,QPID-4948,12654736,[AMQP 1.0] browsing queues not supported,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,Requires means to set and read the distribution-mode of the receiver link in proton engine.
Bug,QPID-5156,12670147,[AMQP 1.0] assert should check node properties,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"Especially important for dynamic nodes, but would be nice to support existing assert behaviour also. "
Bug,QPID-5341,12679261,Allow use of proton 0.6,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,which is now in rc1 and assuming no significant changes should work fine when released
Bug,QPID-5289,12677384,[AMQP 1.0] error descriptions are not given in exceptions by client,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"E.g. if attempting to transfer to a queue that would exceed max depth, the exception thrown is a connection-exception and simply says 'Connection closed by peer'.

There are two parts to this, one is that this should not be a connection exception but a link exception in 1.0. The second is that the error text sent by the broker should be included in the exception."
Bug,QPID-5110,12666705,[AMQP 1.0] make handling of incorrectly typed properties more robust,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"If a property is sent in the wrong type (e.g. as long instead of ulong), subsequent properties get handled incorrectly. Would be nicer to simply skip (or even by lenient and accept) the incorrect types, but handle all others correctly."
Bug,QPID-5083,12664355,[AMQP 1.0] if sasl implementation is not available client (and interlinking) will fail,gsim,gsim,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,E.g. if on fedora you build without cyrus-sasl-devel.
Bug,QPID-4792,12645458,Windows UUID processing mingles GUID values,cliffjansen,cliffjansen,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,"RFC 4122 defines a UUID.  A GUID is the same as a UUID in string form, but differs in binary layout.  Microsoft operates with GUIDs but confusingly labels them as UUIDs in their documentation and include files.

i.e. rpcdce.h:  typedef GUID UUID;

The binary form matters since it is used over the wire.  Mapping a GUID to a UUID (or vice versa) without the layout conversion results in structures with mangled RFC version info and different string representations on Windows and non-Windows systems.

Proton currently only calls Microsoft APIs to obtain the string representation of the UUID (which will match the GUID), so it is unaffected.
"
Bug,QPID-4888,12649349,[AMQP 1.0] link naming is not handled correctly,gsim,gsim,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,"The client does not let the name of the link be controlled, but always defaults it to the name of the node (which doesn't meet uniqueness criteria).

The broker uses the link-, source- and target- names as the key to the managment objects and uses the link- and source- name for subscriptions queues when the source refers to an exchange. The link name is only guaranteed to be unique within the scope of a clients container id."
Bug,QPID-4702,12640762,cmake build of ssl support does not work on certain platforms,gsim,gsim,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,This is a result of the order of libraries and object files passed to the linker. The libraries must follow the .o files that require them or they will be ignored (assumed not needed).
Bug,QPID-4976,12656034,[AMQP 1.0] support standard lifetime policies,gsim,gsim,Closed,Fixed,2013-09-08 13:37,Broker,Client,NONE,"I.e. delete-on-close, delete-on-no-links, delete-on-no-messages and delete-on-no-links-or-messages"
Bug,QPID-3188,12503446,CyrusSasl ctor logic change for callback storage,mgoulish2,mgoulish2,Closed,Fixed,2013-08-20 20:41,Broker,Client,NONE,"The logic that stores callbacks in the CyrusSasl ctor should be changed to make the c++ client behave similarly to other language clients.

If there is no username, then do nothing with either NAME or PASSWD callbacks.
If there is a name but no passwd, then explicitly store an empty PASSWD callback."
Bug,QPID-3620,12531589,time conversions fail on solaris,cliffjansen,cliffjansen,Closed,Fixed,2013-08-20 20:33,Broker,Client,NONE,"Condition::wait(Mutex&, const AbsTime& absoluteTime) fails for far future time during cast/truncation from 64 bit int to posix timespec.tv_sec.  The time is actually in the past and the wait times out instantly."
Bug,QPID-306,12360788,AMQP 0-9 unbind,gsim,aconway,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,Implement new Queue::unbind and Exchange::unbind methods from 0-9.
Bug,QPID-424,12365147,C++: Fix memory leaks,aconway,aconway,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"We need to get to a clean slate on memory leaks, right now valgrind is reporting quite a few.

The current batch of leaks are being suppressed in cpp/test/.vg-supp so that we can make --enable-valgrind the default and catch/fix new leaks quickly going forward. Valgrind errors are equivalent to a test failure, you should not commit with errors.

The supressed leaks also need to be addressed either fix the leak or prove that it's a problem outside qpid's control. 
In the later case the supression description should explain why the leak can safely be ignored."
Bug,QPID-3206,12504157,Variant converts from negative number in string format to unsigned integer without error,gsim,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"E.g. 
  uint16_t i = 0;
  qpid::types::Variant v = ""-5"";
  i = v;

The above results in an exception in older versions of gcc (e.g. 4.1.2) but sets i to 65531 on later versions (e.g. 4.4.4). This is a result of a fix to the gcc std library to be compliant with specification which requires stringstream to accept negative values even for unsigned ints (which is the behaviour of scanf).

See e.g:
http://boost.2283326.n4.nabble.com/conversion-lexical-cast-doesn-t-throw-td2593967.html
http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/97475b21515462c9/ce369a327fa39243#ce369a327fa39243"
Bug,QPID-3030,12497357,C++ buffer encoding allows overflow on write.,kgiusti,kgiusti,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"The framing Buffer::put{Short,Medium,Long}String() or Buffer::putRawData() do not validate the length of the written data, and may allow overflow of the buffer."
Bug,QPID-4452,12617159,issuing and handling of producer credit not implemented,gsim,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,Prevents proper stress testing.
Bug,QPID-1819,12423045,Large messages cause hangs and crashes when using digest-md5 and security layer (ssf 128),gsim,gsim,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"crash ends with:

2009-apr-15 17:43:44 trace guest@QPID.6411302a-229c-4eb1-b097-fc8a613a3233: sent cmd 0: content (65495 bytes) cccccccccccccccc...
2009-apr-15 17:43:44 trace SENT [127.0.0.1:56532]: Frame[BEbe; channel=2; {SessionFlushBody: completed=1; }]
2009-apr-15 17:43:44 trace SENT [127.0.0.1:56532]: Frame[Bbe; channel=2; {MessageTransferBody: destination=message_queue; accept-mode=0; acquire-mode=0; }]
2009-apr-15 17:43:44 trace SENT [127.0.0.1:56532]: Frame[be; channel=2; header (47 bytes); properties={{MessageProperties: content-length=65495; }{DeliveryProperties: exchange=amq.direct; routing-key=routing_key; }}]
qpidd: qpid/amqp_0_10/Connection.cpp:93: virtual size_t qpid::amqp_0_10::Connection::encode(const char*, size_t): Assertion `workQueue.empty() || workQueue.front().encodedSize() <= size' failed.


pstack for hung client:

Thread 2 (Thread 0xb7f77b90 (LWP 16187)):
#0  0x0069a416 in __kernel_vsyscall ()
#1  0x00ce1b3b in write () from /lib/libc.so.6
#2  0x0024fd80 in qpid::sys::Socket::write () from /usr/lib/libqpidcommon.so.0
#3  0x00255eb4 in qpid::sys::posix::AsynchIO::writeable ()
#4  0x00259152 in
boost::detail::function::void_function_obj_invoker1<boost::_bi::bind_t<void,
boost::_mfi::mf1<void, qpid::sys::posix::AsynchIO,
qpid::sys::DispatchHandle&>,
boost::_bi::list2<boost::_bi::value<qpid::sys::posix::AsynchIO*>,
boost::arg<1> (*)()> >, void, qpid::sys::DispatchHandle&>::invoke ()
#5  0x002b77d3 in boost::function1<void, qpid::sys::DispatchHandle&,
std::allocator<boost::function_base> >::operator() () from
/usr/lib/libqpidcommon.so.0
#6  0x002b5b78 in qpid::sys::DispatchHandle::processEvent ()
#7  0x00267ef6 in qpid::sys::Poller::run () from /usr/lib/libqpidcommon.so.0
#8  0x002b53c4 in qpid::sys::Dispatcher::run ()
#9  0x00e8b3d2 in qpid::client::TCPConnector::run ()
#10 0x0025dba1 in ?? () from /usr/lib/libqpidcommon.so.0
#11 0x00dbc51f in start_thread () from /lib/libpthread.so.0
#12 0x00cf204e in clone () from /lib/libc.so.6
Thread 1 (Thread 0xb7f78720 (LWP 16186)):
#0  0x0069a416 in __kernel_vsyscall ()
#1  0x00dc0105 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0
#2  0x00d00e9d in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libc.so.6
#3  0x00e70f4d in qpid::client::Bounds::expand ()
#4  0x00eb4642 in qpid::client::SessionImpl::sendFrame ()
#5  0x00eb479c in qpid::client::SessionImpl::handleOut ()
#6  0x00eb7488 in qpid::client::SessionImpl::sendContent ()
#7  0x00eb7db2 in qpid::client::SessionImpl::sendCommand ()
#8  0x00eb7f07 in qpid::client::SessionImpl::send ()
#9  0x00e68afe in qpid::client::no_keyword::Session_0_10::messageTransfer ()
#10 0x0804cf4f in main ()

"
Bug,QPID-4556,12630133,QueueOptions::setSizePolicy() can cause exception,gsim,brad.hoekstra,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Calling QueueOptions::setSizePolicy() with maxSize > 2GB causes an exception in the C++ broken, which then generates an exception in the C++ client library.

This appears to be because the value is set as an int32 in the FieldTable. The fix appears to be fairly simple:

{noformat} 
Index: 0.20/cpp/src/qpid/client/QueueOptions.cpp
===================================================================
--- 0.20/cpp/src/qpid/client/QueueOptions.cpp	(revision 27169)
+++ 0.20/cpp/src/qpid/client/QueueOptions.cpp	(revision 27170)
@@ -49,8 +49,8 @@
 	
 void QueueOptions::setSizePolicy(QueueSizePolicy sp, uint64_t maxSize, uint32_t maxCount)
 {
-    if (maxCount) setInt(strMaxCountKey, maxCount);
-    if (maxSize) setInt(strMaxSizeKey, maxSize);
+    if (maxCount) setUInt64(strMaxCountKey, maxCount);
+    if (maxSize) setUInt64(strMaxSizeKey, maxSize);
     if (maxSize || maxCount){
         switch (sp)
         {
{noformat} "
Bug,QPID-4257,12605103,"Windows+SSL: Client hang on broker close, broker memory leak",,kbonin,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Windows clients hang when broker dies via SSL connection - fetch never returns even w/ IMMEDIATE timeout.
Windows broker memory grows linearly with SSL connection count, leak per connection, until broker exhausts memory and crashes."
Bug,QPID-243,12359738,Inconsistent use of paths in #includes,astitcher,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"
1. With the new release, I have to specify -I${QPID_REL}/include/qpidc,
-I${QPID_REL/include/qpidc/framing and -I${QPID_REL/include/qpidc/sys when
I build which is really naff.

This is because things like Connector.h do a #include
<framing/InputHandler.h>, but then ""framing/InputHandler.h"" only #include
<AMQFrame.h> and AMQFrame.h is located in the framing sub-directory.

"
Bug,QPID-2407,12456346,C++ SSL session can get bad buffer management,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Thanks to Cliff Jansen for alerting me to this problem.

It's possible for an SSL-negotiated session on Windows to end up with odd errors or an exception. One session I caught in the debugger ended with a ENOBUFS errors on a network receive; the buffer involved ended up having a data-start greater than the length of the buffer, and the calculated receive length for the operation was a negative value.

Can be reproduced using perftest on Windows; I ran against a Linux broker, but similar results can probably happen in either direction depending on the traffic pattern."
Bug,QPID-2728,12468955,Windows icon/version additions broke nightly builds,tross,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Recent additions to include version and icon resources in the Windows builds result in build errors. I don't know why I'm getting different errors on different builds, but here's what I see:

64-bit build:
One of these for each library:
1>.\windows\resources\qpidtypes-resource.rc(20) : fatal error RC1015: cannot open include file 'version-resource.h'.

See: http://www.riverace.com/CDash-1.4.2/viewBuildError.php?buildid=735 for all messages

32-bit build (configure error):
CMake Error in src/CMakeLists.txt:
  Cannot find source file ""qmf-resource.rc"".  Tried extensions .c .C .c++ .cc
  .cpp .cxx .m .M .mm .h .hh .h++ .hm .hpp .hxx .in .txx

"
Bug,QPID-2402,12456036,qpid::messaging.Message::setTTL() unit ambiguity can cause unexpectected behavior,gsim,kbonin,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"qpid::messaging.Message::setTTL( boost::uint64_t ttl ) - does not declare its units.

The currently exposed time types are AbsTime and Duration, which seems to imply they should be used for encapsulating time.

When a Duration object is passed to setTTL, the inline operator int64_t() returns the member variable nanoseconds.

When this value is propagated to the broker, it is interpreted around  /cpp/src/qpid/broker/Message # 353 to be in millisecond units.

I would recommend:
- document Message.setTTL units clearly - pick ms or ns
  - if ms, then overload setTTL to take a Duration object so we can use without error by converting in setTTL
  - if ns, then somewhere downstream (OutgoingMessage#351 ?) the ns needs to get converted to ms

"
Bug,QPID-4095,12596290,Boost 1.50.0 has removed filesystem version 2 from the library,astitcher,davin,Closed,Fixed,2013-07-29 18:53,Broker,Client,Clustering,The build fails when building against boost 1.50.0 because version 0.16 and earlier require boost filesystem version 2 which has been removed from boost version 1.50.0.
Bug,QPID-3457,12520287,qpid::Msg::str() method not exported,aconway,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Trunk r1161742 added a Msg::str() method to cpp/src/qpid/Msg.cpp - this method is not marked with an extern decorator, so it's not visible outside qpidcommon (where Msg.cpp is built) on Windows. This causes build errors on Windows, with unresolved external references to the method."
Bug,QPID-1473,12408786,C++ build process must generate MaxMethodBodySize.h on build platform,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"The release process generates needed C++ code from the various definitions, including MaxMethodBodySize.h, which is very important. However, the MaxMethodBodySize.h generated during release may not be appropriate for all targets. In particular, it is not compatible with what's generated on Windows and results in some static assertion failures that some method bodies are too big. (MAXMETHODBODYSIZE is 148 on Linux, 456 on Windows!)

The fix for this is to have the Windows Visual Studio solution include a project to build the MaxMethodBodySize.h file. I have a project ready and will commit it soon."
Bug,QPID-4011,12556466,TestIsLocalHost unit_test fails with if machine name resolves to loopback address,astitcher,astitcher,Closed,Fixed,2013-07-29 18:53,Broker,Client,Clustering,The new SystemInfo::isLocalHost() code doesn't check correctly for interface addresses that resolve to the loopback address.
Bug,QPID-1458,12408375,C++ common compile error in VC9 Release mode,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"When building C++ common library in Release mode, the following compile errors appear:

1>C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\xutility(419) : error C2664: 'qpid::InlineAllocator<BaseAllocator,Max>::InlineAllocator(const qpid::InlineAllocator<BaseAllocator,Max> &)' : cannot convert parameter 1 from 'qpid::InlineAllocator<BaseAllocator,Max>' to 'const qpid::InlineAllocator<BaseAllocator,Max> &'
1>        with
1>        [
1>            BaseAllocator=std::allocator<std::_Aux_cont>,
1>            Max=3
1>        ]
1>        and
1>        [
1>            BaseAllocator=std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,
1>            Max=3
1>        ]
1>        and
1>        [
1>            BaseAllocator=std::allocator<std::_Aux_cont>,
1>            Max=3
1>        ]
1>        Reason: cannot convert from 'qpid::InlineAllocator<BaseAllocator,Max>' to 'const qpid::InlineAllocator<BaseAllocator,Max>'
1>        with
1>        [
1>            BaseAllocator=std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,
1>            Max=3
1>        ]
1>        and
1>        [
1>            BaseAllocator=std::allocator<std::_Aux_cont>,
1>            Max=3
1>        ]
1>        No user-defined-conversion operator available that can perform this conversion, or the operator cannot be called
1>        C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\xutility(417) : while compiling class template member function 'std::_Container_base_aux_alloc_real<_Alloc>::_Container_base_aux_alloc_real(_Alloc)'
1>        with
1>        [
1>            _Alloc=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\vector(421) : see reference to class template instantiation 'std::_Container_base_aux_alloc_real<_Alloc>' being compiled
1>        with
1>        [
1>            _Alloc=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\include\vector(439) : see reference to class template instantiation 'std::_Vector_val<_Ty,_Alloc>' being compiled
1>        with
1>        [
1>            _Ty=qpid::Range<qpid::framing::SequenceNumber>,
1>            _Alloc=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        .\qpid/InlineVector.h(42) : see reference to class template instantiation 'std::vector<_Ty,_Ax>' being compiled
1>        with
1>        [
1>            _Ty=qpid::Range<qpid::framing::SequenceNumber>,
1>            _Ax=qpid::InlineAllocator<std::allocator<qpid::Range<qpid::framing::SequenceNumber>>,3>
1>        ]
1>        .\qpid/RangeSet.h(168) : see reference to class template instantiation 'qpid::InlineVector<T,Max>' being compiled
1>        with
1>        [
1>            T=qpid::Range<qpid::framing::SequenceNumber>,
1>            Max=3
1>        ]
1>        c:\ace\exported\qpid\trunk\qpid\cpp\src\qpid\framing\SequenceSet.h(31) : see reference to class template instantiation 'qpid::RangeSet<T>' being compiled
1>        with
1>        [
1>            T=qpid::framing::SequenceNumber
1>        ]

This problem does not occur with VC8, nor with VC9 in Debug mode."
Bug,QPID-3478,12522290,Windows Visual Studio 2010 warning C4251 'needs to have dll interface' qpid::amqp_0_10::MapCodec::contentType,chug,chug,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"File cpp/include/qpid/amqp_0_10/Codecs.h has code to the effect of:

class QPID_COMMON_EXTERN MapCodec
{
  public:
    static const std::string contentType;
  private:
};

VS2010 warns that exporting a std::string from a DLL may have unexpected consequences.

One possible solution is from

http://www.eggheadcafe.com/software/aspnet/30952961/a-solution-to-warning-c4251--class-needs-to-have-dllinterface.aspx

2. You can define a wrapper class that has no inline functions and defines all the potentially compiler-generated functions (default ctor, copy ctor, dtor, and assignment operator) and dllexport that.

Other discussion of this issue:

http://stackoverflow.com/questions/2132747/warning-c4251-when-building-a-dll-that-exports-a-class-containing-an-atlcstring
"
Bug,QPID-1957,12428997,FrameDecoder's append() function accesses out-of-range if appending 0 bytes,shuston,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"The append() function in qpid/framing/FrameDecoder.cpp tries to take the address of out-of-range bytes if appending 0 bytes. Although no bytes will actually be written, the [] operator throws an out of range exception in Visual Studio, which is correct since the address of an element that doesn't exist is being requested.

This fixes it:

Index: src/qpid/framing/FrameDecoder.cpp
===================================================================
--- src/qpid/framing/FrameDecoder.cpp   (revision 788779)
+++ src/qpid/framing/FrameDecoder.cpp   (working copy)
@@ -32,7 +32,8 @@
 /** Append up to n bytes from start of buf to end of bytes. */
 void append(std::vector<char>& bytes, Buffer& buffer, size_t n) {
     size_t oldSize = bytes.size();
-    n = std::min(n, size_t(buffer.available()));
+    if ((n = std::min(n, size_t(buffer.available()))) == 0)
+        return;
     bytes.resize(oldSize+n);
     char* p = &bytes[oldSize];
     buffer.getRawData(reinterpret_cast<uint8_t*>(p), n);
"
Bug,QPID-3199,12503979,Severe but difficult to diagnose lock error in qpid::sys::StateMonitor,astitcher,astitcher,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,"The qpid::sys::StateMonitor class has 4 member functions liker this:
  void waitFor(Enum s) { ScopedWait(*this); while (s != state) wait(); }

However the ScopeWait(*this); is in error, because it creates a temporary ScopedWait and then immediately destroys it. Instead of locking this and then unlocking it at the end of the function execution.

What was meant was:
  void waitFor(Enum s) { ScopedWait w(*this); while (s != state) wait(); }

which creates a local variable w which is destroyed at the end of the function execution unlocking this.

It is possible that the compiler/options we use do not actually exhibit this bug. As the correct behaviour may not actually be implemented by all compilers.

If this bug exhibits it might show as StateMonitor::waitFor() never detecting the desired state for instance. It is remarkable that this code has been in the codebase for 3.5 years and we've not noticed any bug caused by it.

This bug was detected by the work on QPID-3004: The clang++ compiler detected that the value being returned by the constructor was not being used at all."
Bug,QPID-2392,12455496,Powershell scripts not included in release source kits,shuston,shuston,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,The release process for 0.6 didn't contain the Powershell scripts for the C++ broker/client test suite on Windows.
Bug,QPID-561,12377259,c++ broker using incorrect value for xa-ok.,,aconway,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,"The qpidd broker uses the constant XA_OK=8, but the 0-10 XML defines xa-ok=0. The value 8 looks like a 0-9 throwback.
It appears that python uses the incorrect value also, since changing it to - broke the python xa tests with the broker.

constants.h now provides generated C++ constants for all AMQP constants define in XML, we should replace all hand-written constants with constants based on the generated ones."
Bug,QPID-1867,12425927,C++ build failure on RHEL 5 starting at about r776144,shuston,shuston,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,"The following errors started happening Tuesday night/Wednesday morning on my RHEL 5 system:
g++ -DHAVE_CONFIG_H -I. -I../../../src -I. -Igen -I../../../src/gen -Werror -pedantic -Wall -Wextra -Wno-shadow -Wpointer-arith -Wcast-qual -Wcast-align -Wno-long-long -Wvolatile-register-var -Winvalid-pch -Wno-system-headers -Woverloaded-virtual -I/usr/include/nspr4 -I -g -O2 -MT qpid/sys/ssl/libsslcommon_la-util.lo -MD -MP -MF qpid/sys/ssl/.deps/libsslcommon_la-util.Tpo -c ../../../src/qpid/sys/ssl/util.cpp -fPIC -DPIC -o qpid/sys/ssl/.libs/libsslcommon_la-util.o
../../../src/qpid/sys/ssl/util.cpp:29:21: error: pk11pub.h: No such file or directory
../../../src/qpid/sys/ssl/util.cpp:30:17: error: ssl.h: No such file or directory
../../../src/qpid/sys/ssl/util.cpp:71: error: 'PK11SlotInfo' was not declared in this scope
../../../src/qpid/sys/ssl/util.cpp:71: error: expected primary-expression before ',' token
../../../src/qpid/sys/ssl/util.cpp:71: error: expected primary-expression before 'retry'
../../../src/qpid/sys/ssl/util.cpp:71: error: expected primary-expression before 'void'
../../../src/qpid/sys/ssl/util.cpp:71: error: initializer expression list treated as compound expression
../../../src/qpid/sys/ssl/util.cpp:72: error: expected ',' or ';' before '{' token
../../../src/qpid/sys/ssl/util.cpp:80: error: 'PK11SlotInfo' was not declared in this scope
../../../src/qpid/sys/ssl/util.cpp:80: error: expected primary-expression before ',' token
../../../src/qpid/sys/ssl/util.cpp:80: error: expected primary-expression before 'retry'
../../../src/qpid/sys/ssl/util.cpp:80: error: expected primary-expression before 'void'
../../../src/qpid/sys/ssl/util.cpp:80: error: initializer expression list treated as compound expression
../../../src/qpid/sys/ssl/util.cpp:81: error: expected ',' or ';' before '{' token
../../../src/qpid/sys/ssl/util.cpp:118: error: expected `}' at end of input
../../../src/qpid/sys/ssl/util.cpp:118: error: expected `}' at end of input
../../../src/qpid/sys/ssl/util.cpp:118: error: expected `}' at end of input
make[3]: *** [qpid/sys/ssl/libsslcommon_la-util.lo] Error 1
g++ -DHAVE_CONFIG_H -I. -I../../../src -I. -Igen -I../../../src/gen -Werror -pedantic -Wall -Wextra -Wno-shadow -Wpointer-arith -Wcast-qual -Wcast-align -Wno-long-long -Wvolatile-register-var -Winvalid-pch -Wno-system-headers -Woverloaded-virtual -I/usr/include/nspr4 -I -g -O2 -MT qpid/sys/ssl/libsslcommon_la-SslSocket.lo -MD -MP -MF qpid/sys/ssl/.deps/libsslcommon_la-SslSocket.Tpo -c ../../../src/qpid/sys/ssl/SslSocket.cpp -fPIC -DPIC -o qpid/sys/ssl/.libs/libsslcommon_la-SslSocket.o
../../../src/qpid/sys/ssl/SslSocket.cpp:42:21: error: pk11pub.h: No such file or directory
../../../src/qpid/sys/ssl/SslSocket.cpp:43:17: error: ssl.h: No such file or directory
../../../src/qpid/sys/ssl/SslSocket.cpp:44:17: error: key.h: No such file or directory
../../../src/qpid/sys/ssl/SslSocket.cpp: In constructor 'qpid::sys::ssl::SslSocket::SslSocket()':
../../../src/qpid/sys/ssl/SslSocket.cpp:111: error: 'SSL_ImportFD' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp: In constructor 'qpid::sys::ssl::SslSocket::SslSocket(qpid::sys::IOHandlePrivate*, PRFileDesc*)':
../../../src/qpid/sys/ssl/SslSocket.cpp:121: error: 'SSL_ImportFD' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:122: error: 'SSL_ResetHandshake' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:122: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:123: error: 'SSL_ForceHandshake' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:123: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp: In member function 'void qpid::sys::ssl::SslSocket::connect(const std::string&, uint16_t) const':
../../../src/qpid/sys/ssl/SslSocket.cpp:141: error: 'NSS_GetClientAuthData' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:141: error: 'SSL_GetClientAuthDataHook' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:141: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:142: error: 'SSL_SetURL' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:142: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:155: error: 'SSL_ForceHandshake' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:155: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp: In member function 'int qpid::sys::ssl::SslSocket::listen(uint16_t, int, const std::string&, bool) const':
../../../src/qpid/sys/ssl/SslSocket.cpp:169: error: 'SSL_ImportFD' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:171: error: 'SSL_REQUEST_CERTIFICATE' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:171: error: 'SSL_OptionSet' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:171: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:172: error: 'SSL_REQUIRE_CERTIFICATE' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:172: error: 'SSL_OptionSet' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:172: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:176: error: 'CERTCertificate' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:176: error: 'cert' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:176: error: 'PK11_FindCertFromNickname' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:178: error: 'SECKEYPrivateKey' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:178: error: 'key' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:178: error: 'PK11_FindKeyByAnyCert' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:180: error: 'NSS_FindCertKEAType' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:180: error: 'SSL_ConfigSecureServer' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:180: error: 'SECSuccess' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:181: error: 'SECKEY_DestroyPrivateKey' was not declared in this scope
../../../src/qpid/sys/ssl/SslSocket.cpp:182: error: 'CERT_DestroyCertificate' was not declared in this scope
make[3]: *** [qpid/sys/ssl/libsslcommon_la-SslSocket.lo] Error 1

"
Bug,QPID-52,12353771,"C++ build fails on RHEL 4, unordered_map not available.",aconway,aconway,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,"c++ broker no longer builds on RHEL4. In 
particular the <tr1/memory> & <tr1/unordered_map> includes in FieldTable 
were causing errors"
Bug,QPID-4435,12615969,Reconnect on connect failure hangs at third address to try,astitcher,astitcher,Closed,Fixed,2012-11-13 22:19,Broker,Client,NONE,"Necessary conditions to trigger hang:

* You are connecting to a name that resolves to 3 or more underlying network addresses.
* The first 2 addresses refuse the connection (there is no daemon listening on the appropriate port at that address).

In this case the client will attempt to connect to the third resolved address, but will hang forever waiting.

If you look at a server log that is listening on the third address then you will eventually see:
   ... error Connection ... No protocol received closing
because the server has received the connection and made the initial reply but has not heard back in the alloted time."
Bug,QPID-982,12394996,C++ rubygen code generator sensitive to ruby version.,,aconway,Closed,Fixed,2012-09-18 22:33,Broker,Client,NONE,"ruby generator does not work with some 1.8.6 versions of ruby, as discussed on qpid-dev:

> On Tue, Apr 29, 2008 at 1:41 PM, Gordon Sim <gsim@redhat.com> wrote:
> 
>> Senaka Fernando wrote:
>>
>>> My version of ruby is,
>>>
>>> ruby 1.8.6 (2007-06-07 patchlevel 36) [i486-linux]
>>>
>> The problem does appear to be related to ruby version. Arnaud hit the same
>> problem with 1.8.6.111 and on upgrading to 1.8.6.114 the problem went away
>> and the files were generated as expected.
>>"
Bug,QPID-3004,12495825,Qpid does not compile cleanly with clang++ compiler (2.8),,astitcher,Closed,Fixed,2011-05-09 21:05,Broker,Client,Clustering,"The Clang project C++ compiler has got to the point where it can now compile the qpid C++ code.

There are some advantages of using this compiler over the GCC compiler that we've previously been using for Unix compiles:
  Much better error messages:
  Faster compiles
and of course there are disadvantages too.

In general I believe there is no portable code just ported code, but code that compiles under the most environments will naturally be the most portable and I'd assert the most bug free too. Therefore I think it is to the benefit of the Qpid if we get the C++ code to compile under clang++ too.

Currently there appear to be a vast number of warnings of the form:

In file included from ../../src-working/cpp/src/qpid/client/SessionImpl.h:35:
./qpid/framing/AMQP_ClientOperations.h:54:30: warning: extra ';' inside a class [-pedantic]
        ConnectionHandler(){};
                             ^

[You'll note that there is an indicator of where in the line the error occurs too as well as just the line no. - the variable pitch font messes it up though]

And there are some smaller number of actual compile errors."
Bug,QPID-2916,12478587,C++ broker & Python client will silently truncate strings whose length is greater than the max length supported by the type.,kgiusti,kgiusti,Closed,Fixed,2010-10-28 21:41,Broker,Client,NONE,"While testing QMF, I attempted to send a string of length > 255 bytes as a str8.  Both the broker and the python client will encode the string by either truncating it, or incorrectly truncating the length."
Bug,QPID-1722,12416469,Use of gethostbyname() in Socket.cpp isn't thread safe,astitcher,astitcher,Closed,Fixed,2009-03-09 21:22,Broker,Client,NONE,"Using gethostbyname() like this in multiple threads at once (for instance connecting simultaneously) may cause client/broker crashes

The best fix is to replace the old API used with the re-entrant and more featureful getaddrinfo() API
"
Bug,QPID-7860,13087239,[cpp] Build produces deprecation warnings on recent Fedora,jross,jross,Resolved,Fixed,2017-10-27 14:17,Broker,Client,NONE,"{noformat}
-- Found SWIG: /usr/bin/swig (found version ""3.0.11"") 
-- Found PythonLibs: /usr/lib64/libpython2.7.so (found version ""2.7.13"") 
-- Found Perl: /usr/bin/perl (found version ""5.24.1"") 
-- Found PerlLibs: /usr/lib64/libperl.so (found version ""5.24.1"") 
-- Building Python bindings
CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qpid/python/CMakeLists.txt:35 (swig_add_module)


CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qmf2/python/CMakeLists.txt:35 (swig_add_module)


-- Building Ruby bindings
CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qpid/ruby/CMakeLists.txt:48 (swig_add_module)


CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qmf2/ruby/CMakeLists.txt:39 (swig_add_module)


-- Building Perl bindings
CMake Deprecation Warning at /usr/share/cmake/Modules/UseSWIG.cmake:226 (message):
  SWIG_ADD_MODULE is deprecated.  Use SWIG_ADD_LIBRARY instead.
Call Stack (most recent call first):
  bindings/qpid/perl/CMakeLists.txt:31 (swig_add_module)


-- Configuring done
-- Generating done
-- Build files have been written to: /home/jross/code/qpid-cpp/bld
{noformat}"
Bug,QPID-6661,12849576,[AMQP 1.0] heartbeat anomalies,gsim,gsim,Closed,Fixed,2016-09-06 21:32,Broker,Client,NONE,"The first heartbeat is often sent after the full idle period, whereas subsequent heartbeats are sent twice as frequently. This happens on both broker and client. This is a result of the periodic timer task that triggers the heartbeats being out of sync with the times computed by proton.

Also on the client, occasionally a heartbeat is missed. This is in part due to the issue above, but also occasionally due to timing of incoming heartbeats with respect to the timer task, resulting in proton emitting the heartbeat but it not actually being written to the wire."
Bug,QPID-5609,12699387,QPID fails to compile in C++11 with Boost 1.54 ,,andyrobo60,Closed,Fixed,2014-04-02 21:40,Broker,Client,NONE,"QPID fails to compile with GCC 4.8.2 and Boost 1.54 in C+\+11 using the compiler flag ""-std=c++11"". 

This problem is caused by a change to Boost's shared_ptr. When compiling in c+\+11 the shared_pointer interface is changed to match c++11's std::shared_pointer. This causes the boolean conversion operator to be made explicit, preventing the implicit conversion to a boolean when returning a shared_ptr from a function. 

To get QPID to compile with GCC 4.8.2 and C+\+11 extra compiler flags are needed. After running CMake modify the CMakeCache.txt file and set the variable ""CMAKE_CXX_FLAGS"" to ""-std=c+\+11 -Wno-unused-local-typedefs -Wno-ignored-qualifiers -Wno-deprecated-declarations"". Passing the variable to CMake on the command line can cause problems as CMake doesn't like the '=' in the flag ""-std=c+\+11""."
Bug,QPID-5304,12677898,Unit test program has bad failure mode if XML_LIB is not set,astitcher,astitcher,Closed,Fixed,2014-02-19 11:30,Broker,Client,NONE,"If you have built the xml exchange, then it is impossible to just run the unit test program manually without at least setting XML_LIB as the program will abort very early on.

This is particularly annoying if you just want to test something unrelated quickly."
Bug,QPID-1745,12417105,C++ Windows; IntegerTypes.h need not define size_t,shuston,shuston,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"The qpid/cpp/src/qpid/sys/windows/IntegerTypes.h file typedefs size_t. This is not necessary for VC9, and the definition conflicts with the proper def for 64-bit builds. Removing the typedef for size_t works for both 32- and 64-bit builds."
Bug,QPID-3282,12508470,Potential bug when checking socket connections for identical local and remote endpoint,astitcher,astitcher,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Currently there is a check in Socket::connect that tries to make sure we don't try to connect to the same endpoint that the local end is bound to, this can happen in rare circumstances when connecting to localhost when the OS decides to bind the local end to a port that has just been given up by an exiting application that we are just about to retry connecting to.

However the existing test doesn't canonicalise the endpoint names so it might try to do a string compare of ""localhost:1234"" with ""127.0.0.1:1234"" and fail even though it should succeed."
Bug,QPID-3035,12497573,Removing a sequence number from a SequenceSet can corrupt the sequence.,kgiusti,kgiusti,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Given a SequenceSet with disjoint sub-sequences, deleting from the end of one sequence will corrupt a following sequence (if present).  

Example - given the following sequence:

{[1,6] [10,20]}

deleting the sequence ""6"" will result in the following:

{[1,5] [7,20]}

the trailing subsequence now incorrectly includes 7-9."
Bug,QPID-1068,12396261,C++ configure fails if help2man not present,astitcher,shuston,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Recent email suggested that help2man is not really a requirement for configuring/building the C++ code, and if it's not present, the man pages should not be generated. However, if help2man is  not present, the configure fails. This patch fixes that - if help2man is not present, the docs/man directory is not built."
Bug,QPID-557,12376706,Clean  up all avoidable valgrind issues ,,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"qpid/cpp/src/tests/.valgrind.supp-default suppresses a bunch of leaks and other errors. They appear to be harmless but most can probably be avoided by minor rework of the code. Clean up all the avoidable issues and trim the suppressions file down to the bare minimum of unavodiable errors harmless error reports, annotate each error remaining with comments explaining why it is harmless.
"
Bug,QPID-1993,12430897,"Solved the ""ignoring return value"" error",gsim,chenta,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"Every time I get the latest source code from the repository. The compiler always complain about ignoring return value. 
The original trick to suppress this warning seems ok. But maybe the recent version of gcc doesn't accept this trick anymore. So I decide to use a temporary variable to handle this problem."
Bug,QPID-3638,12532354,incompatibility with new boost version 1.48,tross,nsantos,Closed,Fixed,2013-07-29 18:53,Broker,Client,NONE,"qpid/log/Logger.cpp:26:43: fatal error: boost/pool/detail/singleton.hpp: No such file or directory

Looks like the code under boost/pool has been re-organized in version 1.48, and that file no longer exists."
Bug,QPID-4669,12639142,require proton 0.3 or greater,gsim,gsim,Closed,Fixed,2013-07-29 18:52,Broker,Client,NONE,0.2 is too out of date and qpidc won't compile against it.
Bug,QPID-117,12356194,C++ code won't build on Ubuntu due to assumptions about where apr headers live,aconway,astitcher,Closed,Fixed,2013-07-29 15:15,Broker,Client,NONE,"The C++ code includes apr headers using ""apr-1/apr_..."" this doesn't generally work as the spr headers need not be in a subdirectory called this. Indeed under Ubuntu they are in a directory called apr-1.0.

The solution is to follow the normal include usage for apr and just include ""apr_,,,""."
Bug,QPID-296,12360537,C++ Header guards may not be compliant with C++ standard,kpvdr,astitcher,Closed,Fixed,2013-07-29 13:58,Broker,Client,NONE,"According to the C++ standard symbols that have a single ""_"" followed by an uppercase
letter and symbols starting with ""__"" (double underscore are reserved for the implementer (That is usually the
compiler/library writer). 

There are numerous header files with guards that violate this standard in the C++ source base."
Bug,QPID-1069,12396267,Patch to build trunk with Boost 1.35,astitcher,shuston,Closed,Fixed,2013-07-29 18:54,Broker,Client,NONE,"Trunk C++ code fails to build with Boost 1.35 - there's a missing Boost feature prior to 1.35 that is now available. This patch allows C++ trunk code to build with Boost 1.35.
Index: Blob.h
===================================================================
--- Blob.h      (revision 657445)
+++ Blob.h      (working copy)
@@ -27,6 +27,7 @@
 #include <boost/utility/typed_in_place_factory.hpp>
 #include <boost/type_traits/is_base_and_derived.hpp>
 #include <boost/utility/enable_if.hpp>
+#include <boost/version.hpp>

 #include <new>

@@ -39,7 +40,8 @@
 using boost::in_place;
 using boost::typed_in_place_factory_base;

-/** 0-arg typed_in_place_factory, missing in boost. */
+/** 0-arg typed_in_place_factory, missing in pre-1.35 boost. */
+#if (BOOST_VERSION < 103500)
 template <class T>
 struct typed_in_place_factory0 : public typed_in_place_factory_base {
     typedef T value_type ;
@@ -49,6 +51,7 @@
 /** 0-arg in_place<T>() function, missing from boost. */
 template<class T>
 typed_in_place_factory0<T> in_place() { return typed_in_place_factory0<T>(); }
+#endif

 template <class T, class R=void>
 struct EnableInPlace
"
Bug,QPID-7357,12990459,c++ HA Backup crash during re-connect in failover,aconway,aconway,Closed,Fixed,2016-09-06 21:33,Broker,Clustering,NONE,"A backup creates an UpdateTracker to delete non-existent queues at the end of an update, in the UpdateTracker destructor. However if an update is interrupted, it can leave a partially-used UpdateTracker behind. When the next update starts this can incorrectly delete queues at a sensitive moment and cause a crash.

See also https://bugzilla.redhat.com/show_bug.cgi?id=1333767"
Bug,QPID-4223,12603233,[New HA] Completion isn't sent when queue that has acquired but unacknowledged messages is deleted,aconway,ncdc,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,NONE,"When testing the new HA in 0.18 (from the svn branch, revision 1370693), I've run into a problem where I can't run qpid-cpp-benchmark after I shut down one of the backups.  Here's the scenario:

Start 3 brokers (in my test on 3 different hosts) using the following command line:

qpidd --auth no --load-module ha.so --ha-cluster yes --ha-brokers-url <insert url here> --ha-replicate all

Promote 1 of the brokers to primary.  Run qpid-cpp-benchmark with the default options.  The test should succeed and provide results.  Next, quit 1 of the 2 backups.  Finally, run qpid-cpp-benchmark again.  This time, it hangs.  Looking at the output of ""qpid-stat -q,"" I see there are some unacked messages that have been delivered to the running qpid-receive process."
Bug,QPID-3963,12551622,A federated broker may not reconnect to a remote cluster on link failure.,kgiusti,kgiusti,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,NONE,"When a broker is federated with a cluster, the cluster informs the broker of the failover addresses that are valid for the cluster.  Should a cluster member fail, the broker will reconnect to another member of that cluster.

However, the federated broker only queries the cluster for these failover addresses when it first connects to the cluster.  Should the cluster topology change, the federated broker's list of available failover addresses will become out-of-date.  This can prevent the broker from correctly re-connecting on failure of a cluster member.

Example:
Given cluster with members C1 and C2, and a separate broker B, federate B to connect to C1.   On connecting to C1, B learns the addresses of C2 as an alternate failover address.  Now shutdown C1.  B will reconnect to C2, and learn that C2 is the only member of the cluster (ie. no failover addresses).   After B connects, restart C1 and let it join the cluster.  Then shutdown C2.   Since B does not know that C1 has become available again, B will not attempt to re-connect to it.  Instead, it tries to reconnect to C2 indefinately.

The expected behavior would be to have B reconnect to C1."
Bug,QPID-3215,12504667,cached exchange reference can cause cluster inconsistencies if exchange is deleted/recreated,aconway,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,NONE,"Description of problem:

SemanticState::route() uses a simple cache variable to avoid looking up the
exchange for every message. However if the exchange in question is deleted,
even if then recreated, this can cause inconsistencies in a cluster.

Version-Release number of selected component (if applicable):

1.3

How reproducible:

100% (Quite a contrived example though)

Steps to Reproduce:
1. start one cluster node
2. create an exchange, a queue and a binding between them

  qpid-config add exchange topic x
  qpid-config add queue q
  qpid-config bind x q k

3. start a session and send a message to the exchange with the relevant key
(leave session running)

  qpid-send --content-stdin --address x/k

then enter a few lines to send some messages

4. start a new cluster node
5. delete and recreate the exchange, this time add in a different binding

  qpid-config del exchange x
  qpid-config add exchange topic x
  qpid-config add queue q2
  qpid-config bind x q2 k  

6. send some more messages on the session from 3. with same exchange and key
(i.e. type in some more messages if using qpid-send as suggested)

  now have an inconsistency where the second node has some messages in q2 and
some (though fewer than first node) in q1, whereas for first node all the
messages are in q1

7. qpid-receive --address 'q2; {mode: browse}' --broker localhost:5673
--capacity 1 (assuming second node is 5673)

Actual results:

First node shutsdown with inconsistent error

Expected results:

No inconsistency, should be able to run the command in 7 against q or q2 on
either node and see the same results.
"
Bug,QPID-2403,12456050,Consistent management names for connections in a cluster.,aconway,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,QMF,"Management objects representing connections in a broker are named for the remote end of the socket ip:port. In a cluster, a broker has normal connections and ""shadow"" connections representing a connection on another broker. The shadow connections are named ""[shadow]ip:port"" Management tools use this convention to ignore shadow connections and display only the local connections to a broker.

This is inconsistent with other management objects which are named identically in all brokers, and the problem is compounded because connections are containers for other objects (sessions, consumers) so inconsistency in the connection name makes the names of all the children inconsistent.

Commit r907123 fixed this by making the connection names consistent and adding a ""shadow"" property to the qmf Connection object. However this broke the Java builds. This JIRA is to discuss what the correct solution should be that works for both brokers."
Bug,QPID-7357,12990459,c++ HA Backup crash during re-connect in failover,aconway,aconway,Closed,Fixed,2016-09-06 21:33,Broker,Clustering,NONE,"A backup creates an UpdateTracker to delete non-existent queues at the end of an update, in the UpdateTracker destructor. However if an update is interrupted, it can leave a partially-used UpdateTracker behind. When the next update starts this can incorrectly delete queues at a sensitive moment and cause a crash.

See also https://bugzilla.redhat.com/show_bug.cgi?id=1333767"
Bug,QPID-4223,12603233,[New HA] Completion isn't sent when queue that has acquired but unacknowledged messages is deleted,aconway,ncdc,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,NONE,"When testing the new HA in 0.18 (from the svn branch, revision 1370693), I've run into a problem where I can't run qpid-cpp-benchmark after I shut down one of the backups.  Here's the scenario:

Start 3 brokers (in my test on 3 different hosts) using the following command line:

qpidd --auth no --load-module ha.so --ha-cluster yes --ha-brokers-url <insert url here> --ha-replicate all

Promote 1 of the brokers to primary.  Run qpid-cpp-benchmark with the default options.  The test should succeed and provide results.  Next, quit 1 of the 2 backups.  Finally, run qpid-cpp-benchmark again.  This time, it hangs.  Looking at the output of ""qpid-stat -q,"" I see there are some unacked messages that have been delivered to the running qpid-receive process."
Bug,QPID-3963,12551622,A federated broker may not reconnect to a remote cluster on link failure.,kgiusti,kgiusti,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,NONE,"When a broker is federated with a cluster, the cluster informs the broker of the failover addresses that are valid for the cluster.  Should a cluster member fail, the broker will reconnect to another member of that cluster.

However, the federated broker only queries the cluster for these failover addresses when it first connects to the cluster.  Should the cluster topology change, the federated broker's list of available failover addresses will become out-of-date.  This can prevent the broker from correctly re-connecting on failure of a cluster member.

Example:
Given cluster with members C1 and C2, and a separate broker B, federate B to connect to C1.   On connecting to C1, B learns the addresses of C2 as an alternate failover address.  Now shutdown C1.  B will reconnect to C2, and learn that C2 is the only member of the cluster (ie. no failover addresses).   After B connects, restart C1 and let it join the cluster.  Then shutdown C2.   Since B does not know that C1 has become available again, B will not attempt to re-connect to it.  Instead, it tries to reconnect to C2 indefinately.

The expected behavior would be to have B reconnect to C1."
Bug,QPID-3215,12504667,cached exchange reference can cause cluster inconsistencies if exchange is deleted/recreated,aconway,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,NONE,"Description of problem:

SemanticState::route() uses a simple cache variable to avoid looking up the
exchange for every message. However if the exchange in question is deleted,
even if then recreated, this can cause inconsistencies in a cluster.

Version-Release number of selected component (if applicable):

1.3

How reproducible:

100% (Quite a contrived example though)

Steps to Reproduce:
1. start one cluster node
2. create an exchange, a queue and a binding between them

  qpid-config add exchange topic x
  qpid-config add queue q
  qpid-config bind x q k

3. start a session and send a message to the exchange with the relevant key
(leave session running)

  qpid-send --content-stdin --address x/k

then enter a few lines to send some messages

4. start a new cluster node
5. delete and recreate the exchange, this time add in a different binding

  qpid-config del exchange x
  qpid-config add exchange topic x
  qpid-config add queue q2
  qpid-config bind x q2 k  

6. send some more messages on the session from 3. with same exchange and key
(i.e. type in some more messages if using qpid-send as suggested)

  now have an inconsistency where the second node has some messages in q2 and
some (though fewer than first node) in q1, whereas for first node all the
messages are in q1

7. qpid-receive --address 'q2; {mode: browse}' --broker localhost:5673
--capacity 1 (assuming second node is 5673)

Actual results:

First node shutsdown with inconsistent error

Expected results:

No inconsistency, should be able to run the command in 7 against q or q2 on
either node and see the same results.
"
Bug,QPID-2403,12456050,Consistent management names for connections in a cluster.,aconway,aconway,Closed,Fixed,2013-07-29 18:53,Broker,Clustering,QMF,"Management objects representing connections in a broker are named for the remote end of the socket ip:port. In a cluster, a broker has normal connections and ""shadow"" connections representing a connection on another broker. The shadow connections are named ""[shadow]ip:port"" Management tools use this convention to ignore shadow connections and display only the local connections to a broker.

This is inconsistent with other management objects which are named identically in all brokers, and the problem is compounded because connections are containers for other objects (sessions, consumers) so inconsistency in the connection name makes the names of all the children inconsistent.

Commit r907123 fixed this by making the connection names consistent and adding a ""shadow"" property to the qmf Connection object. However this broke the Java builds. This JIRA is to discuss what the correct solution should be that works for both brokers."
Bug,QPID-4907,12650887,qpid-tool displays duplicate entries for objects managed by the broker.,kgiusti,kgiusti,Closed,Fixed,2014-02-19 11:30,Broker,Tools,QMF,"qpid-tool displays two entries for each object managed by the broker.

Example:

$ qpid-config add queue KEN-Q
$ qpid-tool

Management Tool for QPID
qpid: list queue
Object Summary:
    ID   Created   Destroyed  Index
    ============================================================
    141  14:19:42  -          169.KEN-Q
<SNIP>
    156  14:19:42  -          org.apache.qpid.broker:queue:KEN-Q
<SNIP>
qpid: "
Bug,QPID-2842,12473116,references to other objects in qpid-tool use id that doesn't match anything else,tross,gsim,Closed,Fixed,2013-07-29 18:53,Broker,Tools,QMF,"E.g. in the following qpid-tool session it is impossible to accurately identify the session for a given subscription:

qpid: list subscription
Object Summary:
    ID   Created   Destroyed  Index
    =================================================================
    128  08:07:24  -          0-1447-1-0-13:0-1447-1-0-25:v2TopicHB
    129  08:07:24  -          0-1447-1-0-13:0-1447-1-0-23:v2TopicUI
    130  08:07:24  -          0-1447-1-0-13:0-1447-1-0-14:rdest
    131  08:07:24  -          0-1447-1-0-13:0-1447-1-0-18:tdest
    138  08:07:37  -          0-1447-1-0-35:0-1447-1-0-36:my-queue
    127  08:07:24  -          0-1447-1-0-13:0-1447-1-0-21:v2dest
qpid: show 138
Object of type: org.apache.qpid.broker:subscription:_data(7cc0ee44-57d4-2ed7-1a4b-3156ed9a4343)
    Attribute     138
    =============================
    sessionRef    0-1447-1-0-35
    queueRef      0-1447-1-0-36
    name          u'my-queue'
    browsing      False
    acknowledged  True
    exclusive     False
    creditMode    u'CREDIT'
    arguments     {}
    delivered     0

The session ref is shown as 0-1447-1-0-35, but this doesn't help me identify the session...

qpid: list session
Object Summary:
    ID   Created   Destroyed  Index
    ==========================================================================
    137  08:07:37  -          0-0-1-0-3:7c777430-1622-4ad2-923e-40e7074f1df4
    126  08:07:24  -          0-0-1-0-3:GRST500.4398.1
qpid: show 137
Object of type: org.apache.qpid.broker:session:_data(9a57d0d2-8b17-8c84-4fac-5c9a96c2cf75)
    Attribute          137
    ============================================================
    vhostRef           0-0-1-0-3
    name               u'7c777430-1622-4ad2-923e-40e7074f1df4'
    channelId          1
    connectionRef      0-1447-1-0-34
    detachedLifespan   0
    attached           True
    expireTime         None
    maxClientRate      None
    framesOutstanding  0
    TxnStarts          0
    TxnCommits         0
    TxnRejects         0
    TxnCount           0
    clientCredit       0
qpid: show 126
Object of type: org.apache.qpid.broker:session:_data(9a57d0d2-8b17-8c84-4fac-5c9a96c2cf75)
    Attribute          126
    ======================================
    vhostRef           0-0-1-0-3
    name               u'GRST500.4398.1'
    channelId          1
    connectionRef      0-1447-1-0-12
    detachedLifespan   0
    attached           True
    expireTime         None
    maxClientRate      None
    framesOutstanding  0
    TxnStarts          0
    TxnCommits         0
    TxnRejects         0
    TxnCount           0
    clientCredit       0
qpid: 

...as neither the list nor the detail view for sessions use the id of that form.
"
Bug,QPID-3087,12499757,Bad handling of invalid queue arguments,gsim,gsim,Closed,Fixed,2013-07-29 18:53,Broker,Tools,NONE,"Passing bad arguments to queue-declare (e.g. max-count=3.14 or max-size='foo') currently results in those arguments being ignored, but being reported from queue-query or via qmf as they were originally specified. There is a further problem with qpid-config in these cases where it fails due to attempts to convert these values to integers and therefore does not list all queues."
Bug,QPID-4907,12650887,qpid-tool displays duplicate entries for objects managed by the broker.,kgiusti,kgiusti,Closed,Fixed,2014-02-19 11:30,Broker,Tools,QMF,"qpid-tool displays two entries for each object managed by the broker.

Example:

$ qpid-config add queue KEN-Q
$ qpid-tool

Management Tool for QPID
qpid: list queue
Object Summary:
    ID   Created   Destroyed  Index
    ============================================================
    141  14:19:42  -          169.KEN-Q
<SNIP>
    156  14:19:42  -          org.apache.qpid.broker:queue:KEN-Q
<SNIP>
qpid: "
Bug,QPID-2842,12473116,references to other objects in qpid-tool use id that doesn't match anything else,tross,gsim,Closed,Fixed,2013-07-29 18:53,Broker,Tools,QMF,"E.g. in the following qpid-tool session it is impossible to accurately identify the session for a given subscription:

qpid: list subscription
Object Summary:
    ID   Created   Destroyed  Index
    =================================================================
    128  08:07:24  -          0-1447-1-0-13:0-1447-1-0-25:v2TopicHB
    129  08:07:24  -          0-1447-1-0-13:0-1447-1-0-23:v2TopicUI
    130  08:07:24  -          0-1447-1-0-13:0-1447-1-0-14:rdest
    131  08:07:24  -          0-1447-1-0-13:0-1447-1-0-18:tdest
    138  08:07:37  -          0-1447-1-0-35:0-1447-1-0-36:my-queue
    127  08:07:24  -          0-1447-1-0-13:0-1447-1-0-21:v2dest
qpid: show 138
Object of type: org.apache.qpid.broker:subscription:_data(7cc0ee44-57d4-2ed7-1a4b-3156ed9a4343)
    Attribute     138
    =============================
    sessionRef    0-1447-1-0-35
    queueRef      0-1447-1-0-36
    name          u'my-queue'
    browsing      False
    acknowledged  True
    exclusive     False
    creditMode    u'CREDIT'
    arguments     {}
    delivered     0

The session ref is shown as 0-1447-1-0-35, but this doesn't help me identify the session...

qpid: list session
Object Summary:
    ID   Created   Destroyed  Index
    ==========================================================================
    137  08:07:37  -          0-0-1-0-3:7c777430-1622-4ad2-923e-40e7074f1df4
    126  08:07:24  -          0-0-1-0-3:GRST500.4398.1
qpid: show 137
Object of type: org.apache.qpid.broker:session:_data(9a57d0d2-8b17-8c84-4fac-5c9a96c2cf75)
    Attribute          137
    ============================================================
    vhostRef           0-0-1-0-3
    name               u'7c777430-1622-4ad2-923e-40e7074f1df4'
    channelId          1
    connectionRef      0-1447-1-0-34
    detachedLifespan   0
    attached           True
    expireTime         None
    maxClientRate      None
    framesOutstanding  0
    TxnStarts          0
    TxnCommits         0
    TxnRejects         0
    TxnCount           0
    clientCredit       0
qpid: show 126
Object of type: org.apache.qpid.broker:session:_data(9a57d0d2-8b17-8c84-4fac-5c9a96c2cf75)
    Attribute          126
    ======================================
    vhostRef           0-0-1-0-3
    name               u'GRST500.4398.1'
    channelId          1
    connectionRef      0-1447-1-0-12
    detachedLifespan   0
    attached           True
    expireTime         None
    maxClientRate      None
    framesOutstanding  0
    TxnStarts          0
    TxnCommits         0
    TxnRejects         0
    TxnCount           0
    clientCredit       0
qpid: 

...as neither the list nor the detail view for sessions use the id of that form.
"
Bug,QPID-3087,12499757,Bad handling of invalid queue arguments,gsim,gsim,Closed,Fixed,2013-07-29 18:53,Broker,Tools,NONE,"Passing bad arguments to queue-declare (e.g. max-count=3.14 or max-size='foo') currently results in those arguments being ignored, but being reported from queue-query or via qmf as they were originally specified. There is a further problem with qpid-config in these cases where it fails due to attempts to convert these values to integers and therefore does not list all queues."
Bug,QPID-3078,12499275,"qpid-receive's use of the ""-t"" option is ambiguous and will cause the command to fail.",kgiusti,kgiusti,Closed,Fixed,2017-03-12 14:06,Client,Tools,NONE,The '-t' short option for 'timeout' conflicts with the same short version of the 'trace' option.
